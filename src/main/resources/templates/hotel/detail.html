<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{/layout/header::head('í•œë°˜ë„ íˆ¬ì–´')}"></head> <!-- ì´ê±° ì•Œë§ê²Œ ë°”ê¿”ì£¼ì„¸ìš”-->
<style>
.temp {
  border: 1px black solid; 
  
 }
.right {
  border: 1px lightgray solid;
  margin: 22px 0 20px 0;
 } 
.bigPicture {
  width: 100%;
  margin-bottom: 10px;
}
.bigPicture > img{
  width: 100%;
  height: 450px;
  object-fit: cover;
}
.owl_img{
  width: 100%;
  height: 150px;
  object-fit: cover;
}
#imageWrapper {
	height: 180px;
}

.d-block {
  margin: 15px auto 15px auto;
  height: 100px;
}
.hit {
	text-align: left;
	margin-bottom: 10px;
} 
</style>

<body>
	<div th:replace="~{/layout/header::header}"></div>
	
	<div class="main_wrap">
	
	
		 <div class="container text-center">
		  <div class="row">
		    <div class="col-1">	      
		    </div>
		    <div class="col-10" style="border:1px gray dotted; ">
		      	<!--/*ì—¬ê¸°ì— ì‘ì„±/ ë‹¤ ë§Œë“¤ê³  style ì§€ì›Œì£¼ì„¸ìš”  */-->
    		     
    		    <th:block th:if="${session.user != null}">
             <th:block th:if="${session.user.auth == 0}">
               <button type="button" id="btn_edit">í¸ì§‘</button> 
               <button type="button" id="btn_remove">ì‚­ì œ</button> 
             </th:block>
            </th:block>   
            <div class="row">
              <div class="col-8 temp">
                <div class="hit" th:text="|ì¡°íšŒìˆ˜ : ${hotel.hit}|"></div>
                <div class="mainPicture" >
                  <div class="bigPicture">
										<th:block th:each="hotelImage : ${hotelImage}">
											<img th:if="${hotelImage.thumbnail == 1}" th:src="@{|${hotelImage.imagePath}/${hotelImage.filesystemName}|}">
										</th:block>
									</div>
                  <div class="owl-carousel owl-theme" id="imageWrapper">
                    <th:block th:each="hotelImage : ${hotelImage}">
                      <img class="owl_img" th:src="@{|${hotelImage.imagePath}/${hotelImage.filesystemName}|}">
                    </th:block>
                  </div>
                </div>
                <div>
									<div th:text="${hotel.hotelName}"></div>
									<div th:text="${hotel.hotelAddress}" ></div>
									<div th:text="${hotel.phoneNumber}" ></div>
									<div th:text="${hotel.hEmail}" ></div>
									<div th:text="|ìµœì € ${lowPrice[0]}ì› ë¶€í„°|"></div>
									<hr>
									<div th:text="${hotel.hotelDetail}"></div>
								</div>
                <div>
									<div>í¸ì˜ ì‹œì„¤</div>
									<i th:if="${fac.pool == 0}" class="fa-solid fa-person-swimming fa-2xl" style="color: #9399a5;"></i>
									<i th:if="${fac.pool == 1}" class="fa-solid fa-person-swimming fa-2xl" style="color: #2f7fa7;"></i>
									<i th:if="${fac.morning == 0}" class="fa-solid fa-utensils fa-2xl" style="color: #9399a5;"></i>
									<i th:if="${fac.morning == 1}" class="fa-solid fa-utensils fa-2xl" style="color: #2f7fa7;"></i>
									<i th:if="${fac.sauna == 0}" class="fa-solid fa-hot-tub-person fa-2xl" style="color: #9399a5;"></i>
									<i th:if="${fac.sauna == 1}" class="fa-solid fa-hot-tub-person fa-2xl" style="color: #2f7fa7;"></i>
									<i th:if="${fac.roomservice == 0}" class="fa-solid fa-bell-concierge fa-2xl" style="color: #9399a5;"></i>
									<i th:if="${fac.roomservice == 1}" class="fa-solid fa-bell-concierge fa-2xl" style="color: #2f7fa7;"></i>
									<i th:if="${fac.lounge == 0}" class="fa-solid fa-couch fa-2xl" style="color: #9399a5;"></i>
									<i th:if="${fac.lounge == 1}" class="fa-solid fa-couch fa-2xl" style="color: #2f7fa7;"></i>
								</div>
							</div>
							<div class="col-4 temp">
              <div class="right">
                <form th:action="@{/reserve/writeHotel.form}" method="get">
                  <div class="title" id="sideTitle" th:text="${hotel.hotelName}"></div>
                  <input type="hidden" id="hotelNo" name="hotelNo" th:value="${hotel.hotelNo}">
                  <input type="hidden" id="reserveRoomNo" name="roomNo">
                  <div class="roomType">ë°©íƒ€ì…</div>
                  <div class="price">ê¸ˆì•¡</div>
                  <div class="checkIn">ì²´í¬ì¸ : <span th:text="${#dates.format(#dates.createToday(),'yyyy/MM/dd')}"></span></div>
                  <div class="checkout">ì²´í¬ì•„ì›ƒ : <span th:text="${#temporals.format(#temporals.createNow().plusDays(+1), 'yyyy/MM/dd')}"></span></div>
                  <button type="button">ë‚ ì§œ ì„ íƒ</button>
                  <button type="submit">ì˜ˆì•½í•˜ê¸°</button>
                  <button type="button">ì°œí•˜ê¸°</button>
                </form> 
              </div>
              <div id="map" style="width:100%;height:350px;">
                <input type="hidden" id="latitude" th:value="${hotel.latitude}">
                <input type="hidden" id="longitude" th:value="${hotel.longitude}">
              </div>
            </div>
								
								
								
							<th:block th:each="roomType, roomTypeStat : ${roomType}">
              <input type="hidden" th:id="${'roomNo' + roomTypeStat.count}" th:value="${roomType.roomFeatureDto.roomNo}">
              <div>
								<div class="row">
									<div class="col-3 temp">
										<div th:id="${'roomCarousel' + roomTypeStat.count}" class="carousel slide">
										  <div class="carousel-inner">
                        <th:block th:each="roomImage : ${hotelImage}">
                            <div th:if="${roomImage.roomNo == roomType.roomFeatureDto.roomNo}" class="carousel-item">
                               <img th:src="@{|${roomImage.imagePath}/${roomImage.filesystemName}|}" class="d-block w-100" >
                            </div>
                        </th:block>
										    
										  </div>
										  <button class="carousel-control-prev" type="button" th:data-bs-target="${'#roomCarousel' + roomTypeStat.count}" data-bs-slide="prev">
										    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
										    <span class="visually-hidden">Previous</span>
										  </button>
										  <button class="carousel-control-next" type="button" th:data-bs-target="${'#roomCarousel' + roomTypeStat.count}" data-bs-slide="next">
										    <span class="carousel-control-next-icon" aria-hidden="true"></span>
										    <span class="visually-hidden">Next</span>
										  </button>
										</div>
										<div th:text="|ì¹¨ëŒ€ : ${roomType.bed}|"></div>
										<div th:text="|ì „ë§ : ${roomType.rView}|"></div>
										<div th:text="|í—ˆìš©ì¸ì› : ${roomType.people} ëª…|"></div>
										<div th:if="${roomType.bleakfast == 0}">ì¡°ì‹ : <i class="fa-solid fa-x" style="color: #96b2c5;"></i></div>
										<div th:if="${roomType.bleakfast == 1}">ì¡°ì‹ : <i class="fa-sharp fa-solid fa-o" style="color: #96b6c5;"></i></div>
										<div th:if="${roomType.smoke == 0}">í¡ì—° : <i class="fa-solid fa-x" style="color: #96b2c5;"></i></div>
										<div th:if="${roomType.smoke == 1}">í¡ì—° : <i class="fa-sharp fa-solid fa-o" style="color: #96b6c5;"></i></div>
										<div th:text="|${roomType.shower}|"></div>
										<div th:text="|ë°©í¬ê¸° : ${roomType.rSize}|"></div>
									</div>
									<div class="col-6 temp">
										<div th:text="${roomType.roomName}" th:class="${'roomName'+roomTypeStat.count}"></div>
										<div th:text="${roomType.roomDetail}"></div>
										<div>
											<i th:if="${roomType.roomFeatureDto.water == 0}" class="fa-solid fa-bottle-water fa-2xl" style="color: #9399a5;"></i>
											<i th:if="${roomType.roomFeatureDto.water == 1}" class="fa-solid fa-bottle-water fa-2xl" style="color: #2f7fa7;"></i>
											<i th:if="${roomType.roomFeatureDto.coffee == 0}" class="fa-solid fa-mug-saucer fa-2xl" style="color: #9399a5;"></i>
											<i th:if="${roomType.roomFeatureDto.coffee == 1}" class="fa-solid fa-mug-saucer fa-2xl" style="color: #2f7fa7;"></i>
											<i th:if="${roomType.roomFeatureDto.drier == 0}" class="fa-solid fa-wind fa-2xl" style="color: #9399a5;"></i>
											<i th:if="${roomType.roomFeatureDto.drier == 1}" class="fa-solid fa-wind fa-2xl" style="color: #2f7fa7;"></i>
											<i th:if="${roomType.roomFeatureDto.towel == 0}" class="fa-solid fa-rug fa-2xl" style="color: #9399a5;"></i>
											<i th:if="${roomType.roomFeatureDto.towel == 1}" class="fa-solid fa-rug fa-2xl" style="color: #2f7fa7;"></i>
											<i th:if="${roomType.roomFeatureDto.minibar == 0}" class="fa-solid fa-martini-glass fa-2xl" style="color: #9399a5;"></i>
											<i th:if="${roomType.roomFeatureDto.minibar == 1}" class="fa-solid fa-martini-glass fa-2xl" style="color: #2f7fa7;"></i>
											<i th:if="${roomType.roomFeatureDto.iron == 0}" class="fa-solid fa-shirt fa-2xl" style="color: #9399a5;"></i>
											<i th:if="${roomType.roomFeatureDto.iron == 1}" class="fa-solid fa-shirt fa-2xl" style="color: #2f7fa7;"></i>
										</div>
										  
									</div>
									<div class="col-3 temp">
                    <th:block th:each="price : ${price}">
                      <th:block th:if="${price.roomNo == roomType.roomFeatureDto.roomNo}">
                        <th:block th:if="${price.bsDate <= #calendars.format(#calendars.createNow(), 'yyyy/MM/dd') && price.beDate >= #calendars.format(#calendars.createNow(), 'yyyy/MM/dd')}">
                          <div th:text="|ë¹„ìˆ˜ê¸° : ${price.bsDate} ~ ${price.beDate}|"></div>
                          <div th:text="|${price.biPrice}ì›|"> </div>
                        </th:block>
                        <th:block th:if="${price.jsDate <= #calendars.format(#calendars.createNow(), 'yyyy/MM/dd') && price.jeDate >= #calendars.format(#calendars.createNow(), 'yyyy/MM/dd')}">
                          <div th:text="|ì¤€ì„±ìˆ˜ê¸° : ${price.jsDate} ~ ${price.jeDate}|"></div>
                          <div th:text="|${price.junPrice}ì›|"> </div>
                        </th:block>
                        <th:block th:if="${price.ssDate <= #calendars.format(#calendars.createNow(), 'yyyy/MM/dd') && price.seDate >= #calendars.format(#calendars.createNow(), 'yyyy/MM/dd')}">
                          <div th:text="|ì„±ìˆ˜ê¸° : ${price.ssDate} ~ ${price.seDate}|"></div>
                          <div th:text="|${price.sungPrice}ì›|"> </div>
                        </th:block>
                      </th:block>
										</th:block>
										<div><button type="button" class="btn-choice" th:attr="data-roomno=${'roomNo' + roomTypeStat.count}" onclick="selectRoom(this.getAttribute('data-roomno'))">ì„ íƒ</button></div>
										<div th:text="|ë‚¨ì€ë°© : ${roomType.roomMany - countReserveRoom[roomTypeStat.index]} ê°œ| "></div>
									</div>
								</div>
							</div>
              </th:block>  
            </div>
            
            
            	<th:block th:if="${session.user != null}">
        <input type="hidden" name="userNo" id="userNo" th:value="${session.user.userNo}">
        </th:block>
        <!--
        <div th:each="reservation : ${reserve}">
            <div class="reserveNo" th:text="${reservation.reserveNo}|"th:value="${reservation.reserveNo}"></div>
            <div class="reserveUserNo" th:text="${reservation.userDto.userNo}" th:value="${reservation.userDto.userNo}"></div>
        </div>    -->
        
        <div class="choice">ì—¬í–‰ í›„ê¸°</div>
        
          <form class="mb-3 frm_review_add" method="post">
          <div id="myform">
          <fieldset>
            <span class="text-bold"> â¤ï¸ ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”</span>
            <input type="radio" name="star" th:value="5" id="rate1"><label
              for="rate1">â˜…</label>
            <input type="radio" name="star" th:value="4" id="rate2"><label
              for="rate2">â˜…</label>
            <input type="radio" name="star" th:value="3" id="rate3"><label
              for="rate3">â˜…</label>
            <input type="radio" name="star" th:value="2" id="rate4"><label
              for="rate4">â˜…</label>
            <input type="radio" name="star" th:value="1" id="rate5"><label
              for="rate5">â˜…</label>
          </fieldset>
              <input type="hidden" name="packageNo" th:value="${hotel.hotelNo}">
            <div>                          
              <textarea class="col-auto form-control" name="reviewContents" placeholder="í–‰ë³µí–ˆë˜ ì—¬í–‰í›„ê¸°ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”ğŸ™‚"></textarea>   <!-- ì˜ˆì•½í•œì‚¬ëŒë§Œ ë³´ì´ê²Œ -->
              <button type="button" class="btn btn-kong" id="btn_review_add" style="margin-top: 20px; margin-left: 750px">ì‘ì„±ì™„ë£Œ</button>
            </div>
            </div>
           </form>
           
            
          <div style="overflow: hidden;">
           <div id="starAve" style="text-align: left;">ë¦¬ë·°í‰ì </div>
            <div style="height: 100px; float: right;">
                <select id="sortReview" class="form-select form-select-sm mb-3 h-50 d-inline-block" style="width: 120px;" aria-label=".form-select-sm example">
                    <option value="1" selected>ìµœì‹ ìˆœ</option>
                    <option value="2">ë³„ì ìˆœ</option>
                </select>
            </div>
        </div>
        <div id="reviewAccordion">
             <input type="hidden" id="packageNo" name="packageNo" th:value="${hotel.hotelNo}">     
             
        </div>  
    </div>    

            
            
            
            
		    	</div>
		    <div class="col-1">	      
		    </div>
		  </div>
	  </div>
	
	</div>
<script th:inline="javascript">
  var carouselInnerDivs = document.getElementsByClassName('carousel-inner');

		// ê° divì— ëŒ€í•´ ë°˜ë³µ
		for (var i = 0; i < carouselInnerDivs.length; i++) {
    // í˜„ì¬ divì˜ ì²« ë²ˆì§¸ ìì‹ì— í´ë˜ìŠ¤ ì¶”ê°€
	    var firstChild = carouselInnerDivs[i].firstElementChild;
	    
	    // ë§Œì•½ ì²« ë²ˆì§¸ ìì‹ì´ ì¡´ì¬í•œë‹¤ë©´ í´ë˜ìŠ¤ ì¶”ê°€
	    if (firstChild) {
	        firstChild.classList.add('active'); 
		  }
		}
  
  function kakaoMap(){
    var latitude = $('#latitude').val();
    var longitude = $('#longitude').val(); 
    var title = $('#sideTitle').text()
    
    var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
      mapOption = { 
          center: new kakao.maps.LatLng(latitude, longitude), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
          level: 3 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
      };
    
    var map = new kakao.maps.Map(mapContainer, mapOption); // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
    
    // ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜ì…ë‹ˆë‹¤ 
    var markerPosition  = new kakao.maps.LatLng(latitude, longitude); 
    
    // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
    var marker = new kakao.maps.Marker({
        position: markerPosition
    });
    
    // ë§ˆì»¤ê°€ ì§€ë„ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤
    marker.setMap(map);
    
    var iwContent = '<div style="padding:5px;">'+title+'<br><a href="https://map.kakao.com/link/map/Hello World!,'+latitude+','+longitude+'" style="color:blue" target="_blank">í°ì§€ë„ë³´ê¸°</a> <a href="https://map.kakao.com/link/to/Hello World!,'+latitude+','+longitude+'" style="color:blue" target="_blank">ê¸¸ì°¾ê¸°</a></div>', // ì¸í¬ìœˆë„ìš°ì— í‘œì¶œë  ë‚´ìš©ìœ¼ë¡œ HTML ë¬¸ìì—´ì´ë‚˜ document elementê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤
      iwPosition = new kakao.maps.LatLng(33.450701, 126.570667); //ì¸í¬ìœˆë„ìš° í‘œì‹œ ìœ„ì¹˜ì…ë‹ˆë‹¤
  
    // ì¸í¬ìœˆë„ìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
    var infowindow = new kakao.maps.InfoWindow({
        position : iwPosition, 
        content : iwContent 
    });
      
    // ë§ˆì»¤ ìœ„ì— ì¸í¬ìœˆë„ìš°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì¸ markerë¥¼ ë„£ì–´ì£¼ì§€ ì•Šìœ¼ë©´ ì§€ë„ ìœ„ì— í‘œì‹œë©ë‹ˆë‹¤
    infowindow.open(map, marker); 
  }
  
  $(document).ready(function (e){
    
    $(document).on("click","img",function(){
      var path = $(this).attr('src')
      showImage(path);
    });//end click event
    
    function showImage(fileCallPath){
        $(".bigPicture").empty();
        $(".bigPicture")
        .html("<img src='"+fileCallPath+"' >")
        .animate({width:'100%', height: '100%'}, 1000);
        
      }//end fileCallPath
  });

  $(document).ready(function() {
           var owl = $('.owl-carousel');
            owl.owlCarousel({
              items: 4, // í•œë²ˆì— ë³´ì—¬ì§€ëŠ” ì´ë¯¸ì§€ ìˆ˜
              loop: true, // í•­ëª©ë“¤ì„ ë¬´í•œìœ¼ë¡œ ë°˜ë³µí•˜ì—¬ ë³´ì—¬ì¤„ì§€ ì—¬ë¶€
              autoplay: false, // ìë™ìœ¼ë¡œ ìŠ¬ë¼ì´ë“œ ì‡¼ë¥¼ ì‹œì‘í• ì§€ ì—¬ë¶€
              autoplayTimeout: 4000, // ë‹¤ìŒ ì´ë¯¸ì§€ë¡œ ë„˜ì–´ê°€ëŠ” ì‹œê°„ (ë‹¨ìœ„ : ë°€ë¦¬ì´ˆ)
              autoplayHoverPause: true, // ë§ˆìš°ìŠ¤ê°€ ì´ë¯¸ì§€ì— ìœ„ì— ìˆì„ ë•Œ ìë™ ìŠ¬ë¼ì´ë“œë¥¼ ì¼ì‹œì¤‘ì§€ í• ì§€ ì—¬ë¶€
              dots: false,
              nav: true,
              margin: 10,
            });           
          });
  
  function selectRoom(roomNo){
   console.log(roomNo);
   roomNumber = document.getElementById(roomNo).value;
   document.getElementById('reserveRoomNo').value = roomNumber;
   console.log(document.getElementById('reserveRoomNo').value);
   console.log(document.getElementById('hotelNo').value);
 }
  
  const fnReviewAdd = () => {
    $('#btn_review_add').click(() => {         
        // ë°ì´í„° í™•ì¸ìš©
        console.log('Review Contents:', $('textarea[name="reviewContents"]').val());
        console.log('User No:', $('#userNo').val());
        console.log('Package No:', $('input[name="packageNo"]').val());
        console.log('Reserve No:', $('input[name="reserveNo"]').val());
        console.log('Star:', $('input[name="star"]:checked').val());
        
        $.ajax({
            type: 'post',
            url: '/package/addReview.do',
            data: {
                // ë¦¬ë·° ë²ˆí˜¸ë¥¼ ë³´ë‚´ì§€ ì•ŠìŒ
                reviewContents: $('textarea[name="reviewContents"]').val(),
                userNo: $('#userNo').val(),
                packageNo: $('input[name="packageNo"]').val(),
                reserveNo: $('input[name="reserveNo"]').val(),
                star: $('input[name="star"]:checked').val()                
            },
            dataType: 'json',
            success: (resData) => {             
                console.log('Response Data:', resData); // ì½˜ì†”ì— ì‘ë‹µ ë°ì´í„° ì¶œë ¥
                if (resData.addReviewResult === 1) {
                    alert('ë¦¬ë·°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    $('#reviewContents').val('');
                    fnReviewList();
                } else {
                    alert('ë¦¬ë·° ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            },
            error: (xhr, status, error) => {
                console.error('AJAX Error:', error);
                alert('AJAX ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });
    });
}


    var page = 1;
    var totalPage = 0;
  
    const packageNo = $('#packageNo').val();
  
    const fnReviewList = () => { 
      $.ajax({
        type: 'get',
        url: '/package/reviewList.do',
        data: { page: page, packageNo: packageNo},
        dataType: 'json',
        success: (resData) => {
          totalPage = resData.totalPage;
          $('#reviewAccordion').empty();
          const sessionUserNo = $('#userNo').val();
          if (resData.reviewList != null && resData.reviewList.length > 0) {
            $.each(resData.reviewList, (i, review)=> {
              let str = '<div class="accordion accordion-flush">';
              str += '<div class="accordion-item">';
              str += '<h2 class="accordion-header">';
              str += '<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse' + i + '" aria-expanded="false" aria-controls="flush-collapse' + i + '">' + review.userDto.name + 'ë‹˜ì˜ ë¦¬ë·°  ' + generateStarRating(review.star) + '</button>';
              str += '</h2>';
              str += '<div id="flush-collapse' + i + '" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">';
              str += '<div class="accordion-body">' + review.reviewContents + '</div>';
              str += '  <div>';
              if(sessionUserNo == review.userDto.userNo){                
                    str += '  <input type="hidden" value="' + review.reviewNo + '">';
                    str += '  <button type="button" class="btn remove_Review" style="margin-left: 550px;">ì‚­ì œí•˜ê¸°</button>';
                  }
                    str += '  </div>';
              str += '</div>';
              str += '</div>';
              str += '</div>';
                $('#reviewAccordion').append(str);         
            });
          } else {
            $('#reviewAccordion').append('<div class="text-center">ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>');
          }
        },
        error: (error) => {
          console.error('Ajax ìš”ì²­ ì—ëŸ¬:', error);
        }
      });
    };
    
	   $('#sortReview').change(function () {
      const selectedOption = $(this).val();
    
      if (selectedOption === '2') {
         fnReviewStarList();
      } else {
         fnReviewList();
      }
      });	
  
   const fnReviewStarList = () => { 
      $.ajax({
        type: 'get',
        url: '/package/reviewStarList.do',
        data: { page: page, packageNo: packageNo},
        dataType: 'json',
        success: (resData) => {
          totalPage = resData.totalPage;
          $('#reviewAccordion').empty();
          const sessionUserNo = $('#userNo').val();
          if (resData.reviewList != null && resData.reviewList.length > 0) {
            $.each(resData.reviewList, (i, review)=> {
              let str = '<div class="accordion accordion-flush">';
              str += '<div class="accordion-item">';
              str += '<h2 class="accordion-header">';
              str += '<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse' + i + '" aria-expanded="false" aria-controls="flush-collapse' + i + '">' + review.userDto.name + 'ë‹˜ì˜ ë¦¬ë·°  ' + generateStarRating(review.star) + '</button>';
              str += '</h2>';
              str += '<div id="flush-collapse' + i + '" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">';
              str += '<div class="accordion-body">' + review.reviewContents + '</div>';
              str += '  <div>';
              if(sessionUserNo == review.userDto.userNo){                
                    str += '  <input type="hidden" value="' + review.reviewNo + '">';
                    str += '  <button type="button" class="btn remove_Review" style="margin-left: 550px;">ì‚­ì œí•˜ê¸°</button>';
                  }
                    str += '  </div>';
              str += '</div>';
              str += '</div>';
              str += '</div>';
                $('#reviewAccordion').append(str);         
            });
          } else {
            $('#reviewAccordion').append('<div class="text-center">ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>');
          }
        },
        error: (error) => {
          console.error('Ajax ìš”ì²­ ì—ëŸ¬:', error);
        }
      });
    };
  
  
  $(document).ready(function() {
        var sessionUserNo = $('#userNo').val();
        var reserveUserNos = [];
  
        $('.reserveNo').each(function() {
            var reservationUserNo = $(this).next('.reserveUserNo').text();
            reserveUserNos.push(reservationUserNo);
        });    
        var matchingUserNo = reserveUserNos.filter(function(userNo) {
            return userNo === sessionUserNo;
        })[0];
        if (matchingUserNo) {
            $('#myform').show();
        } else {
            $('#myform').hide();
        }
    });
     
      $(document).ready(function() {
          $.ajax({
              type: 'post',
              url: '/package/getAverageRating.do',
              data: {
                  packageNo: $('input[name="packageNo"]').val()
              },
              dataType: 'json',
              success: function(resData) {
                  updateAverageRating(resData.averageRating);
              },
              error: function(xhr, status, error) {
                  console.error('AJAX Error:', error);
                  alert('í‰ê·  ë³„ì  ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
              }
          });
      });
      
      function updateAverageRating(averageRating) {
          var displayText = averageRating ? 'í‰ê·  ë³„ì : ' + averageRating.toFixed(0) : 'í‰ì  : 0';
          $('#starAve').text(displayText);
      }


    const fnReviewRemove = () => {
      $(document).on('click', '.remove_Review', (ev) => {
        if(!confirm('ë¦¬ë·°ë¥¼ ì‚­ì œí• ê¹Œìš”?')){
          return;
        }
        $.ajax({
          // ìš”ì²­
          type: 'post',
          url: '/package/removeReview.do',
          data: 'reviewNo=' + $(ev.target).prev().val(),
          // ì‘ë‹µ
          dataType: 'json',
          success: (resData) => { 
            if(resData.removeResult === 1){
              alert('í•´ë‹¹ ë¦¬ë·°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
              fnReviewList();
            } else {
              alert('ë¦¬ë·°ê°€ ì‚­ì œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }
          }
        })
      })
    }
    
    
    function generateStarRating(star) {
    let stars = '';
    for (let i = 1; i <= 5; i++) {
        if (i <= star) {
            stars += '<i class="fa-solid fa-star" style="color: #ede502;"></i>'; 
        } else {
            stars += '<i class="fa-regular fa-star" style="color: #f0c424;"></i>'; 
        }
    }
    return stars;
} 
  
  
  
  
  kakaoMap();
  
</script>
	
	
	
	<div th:replace="~{/layout/footer::footer}"></div>
</body>
</html>

