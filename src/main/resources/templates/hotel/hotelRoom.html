<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">



	<div class="main_wrap">
		<!--/* Modal Header */-->
					
	  <div class="modal-header">
	    <h1 class="modal-title fs-5" id="staticBackdropLabel">객실 등록</h1>
	    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	  </div>
	  <div class="modal-body">
	    <div class="roomGroup" style="margin:15px;"  >
				<form id="frm_room" name="frm_room" method="post" accept="image/*" enctype="multipart/form-data">
          <input type="hidden" id="hotelNo" name="hotelNo" th:value="${hotelNo}">
		      <div style="text-align: left;">
            <label for="files" class="form-label" style="font-weight: 500;">객실사진첨부</label>
            <input type="file" name="files" id="roomfiles" class="form-control" accept="image/*" multiple> <button type="button" onclick="deleteRoomAll(this)">전체삭제</button>
            <div id="roomattached_list"></div>
          </div>
          <div style="text-align: left;">
  		      <label for="roomName" class="form-label" style="font-weight: 500;">객실이름</label>
  		      <input type="text" id="roomName" class="form-control" name="roomName">
		      </div>
		      <div style="text-align: left;">
  		      <label for="roomDetail" class="col-form-label" style="font-weight: 500;">객실상세</label>
  		      <textarea id="roomDetail" class="form-control" name="roomDetail" rows="10" style="margin-bottom: 10px;"></textarea>
		      </div>
		      <div style="text-align: left;">
  		      <label for="rView" class="form-label" style="font-weight: 500;">전망</label>
  		      <input type="text" id="rView" class="form-control" name="rView" placeholder="오션/산 등"> 
  		      <label for="bed" class="form-label" style="font-weight: 500;">침대</label>
  		      <input type="bed" id="bed"class="form-control" name="bed" placeholder="더블/킹 등"> 
  		      <label for="shower" class="form-label" style="font-weight: 500;">욕실</label>
  		      <input type="text" id="shower" class="form-control" name="shower" placeholder="샤워실/욕조"> 
  		      <label for="rSize" class="form-label" style="font-weight: 500;">방사이즈</label>
  		      <input type="number" id="rSize" class="form-control" name="rSize" placeholder="㎡">
  		      <div>
  		      <label for="smoke" class="form-check-label" style="font-weight: 500;">흡연유무</label>
  		      <input type="checkbox" id="smoke" class="form-check-input" name="smoke" value="1">
  		      <label for="bleakfast" class="form-check-label" style="font-weight: 500;">조식</label>
  		      <input type="checkbox" id="bleakfast" class="form-check-input" name="bleakfast" value="1">
  		      </div>
  		      <label for="people" class="form-label" style="font-weight: 500;">허용인원</label>
  		      <input type="number" id="people" class="form-control" name="people">
  		      <label for="roomMany" class="form-label" style="font-weight: 500;">객실개수</label>
  		      <input type="number" id="roomMany" class="form-control" name="roomMany">
		      </div>
		      <div style="text-align: left;">
  		      <div style="font-weight: 500; margin-bottom: 10px;">객실 구비사항</div>
  		      <label for="towel" class="form-check-label">수건</label>
  		      <input type="checkbox" id="towel" class="form-check-input" name="towel" value="1">
  		      <label for="water" class="form-check-label">생수</label>
  		      <input type="checkbox" id="water" class="form-check-input" name="water" value="1">
  		      <label for="coffee" class="form-check-label">커피/티</label>
  		      <input type="checkbox" id="coffee" class="form-check-input" name="coffee" value="1">
  		      <label for="drier" class="form-check-label">드라이기</label>
  		      <input type="checkbox" id="drier" class="form-check-input" name="drier" value="1">
  		      <label for="iron" class="form-check-label">다리미</label>
  		      <input type="checkbox" id="iron" class="form-check-input" name="iron" value="1">
  		      <label for="minibar" class="form-check-label">미니바</label>
  		      <input type="checkbox" id="minibar" class="form-check-input" name="minibar" value="1">
		      </div>
  		      <div style="font-weight: 500; margin-bottom: 10px; text-align: left">비수기</div>
		      <div class="d-flex ">
  		      <input type="number" id="biPrice" name="biPrice" class="form-control" placeholder="금액">
  		      <label for="bsDate" class="form-label">날짜</label>
  		      <input type="date" id="bsDate" name="bsDate"><input type="date" id="beDate" name="beDate">
		      </div>
  		      <div style="font-weight: 500; margin-bottom: 10px; text-align: left">준성수기</div>
		      <div class="d-flex ">
  		      <input type="number" id="junPrice" name="junPrice" class="form-control" placeholder="금액">
  		      <label for="jsDate" class="form-label">날짜</label>
  		      <input type="date" id="jsDate" name="jsDate"><input type="date" id="jeDate" name="jeDate">
		      </div>
  		      <div style="font-weight: 500; margin-bottom: 10px; text-align: left">성수기</div>
		      <div class="d-flex">
  		      <input type="number" id="sungPrice" class="form-control" name="sungPrice" placeholder="금액">
  		      <label for="ssDate" class="form-label" style="width: max-content;">날짜</label>
  		      <input type="date" id="ssDate" name="ssDate"><input type="date" id="seDate" name="seDate">
		      </div>
		      <!--<input type="date" value="<fmt:formatDate value="${contentNotice}" pattern = "yyyy-MM-dd"/>"> -->
      </form>
	  </div>
	  <div class="modal-footer">
	    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
	    <button type="button" class="btn btn-primary" id="btn_room">등록</button>
	  </div>
	</form>
	
	</div>

<script>
     
   $('#btn_room').click(() => {
		 var form = $('#frm_room')[0];
		 var formData = new FormData(form)
		 
		 $.ajax({
			 type: 'POST',
			 enctype: 'multipart/form-data',
			 url: '/hotel/addHotelRoom.do',
			 data: formData,
			 processData: false,
		   contentType: false,
		   cache: false,
		   dataType: 'text',
			 success: (resData) => {
				 if(resData != null && resData != ""){
					 if(resData == 1){
						 alert("등록되었습니다.");
						 $('#staticBackdrop').modal('hide');
					 } else if(resData == 0) {
						 alert("등록되지않았습니다.");
					 }
				 }
			 }
		 })
   })
  
$('input[type="date"]').change(() => {
   
        var bsDate = new Date($('#bsDate').val());
        var beDate = new Date($('#beDate').val());
        var jsDate = new Date($('#jsDate').val());
        var jeDate = new Date($('#jeDate').val());
        var ssDate = new Date($('#ssDate').val());
        var seDate = new Date($('#seDate').val());
        
        if(bsDate > beDate || jsDate > jeDate || ssDate > seDate){
          alert('날짜를 다시 선택해 주세요 ');
        }
    });
    
 function deleteRoomAll() {
    $('#files').val('');
     $('#roomattached_list').empty();
 }
 
  // 개별 파일의 삭제 버튼에 적용할 메소드
    function fndeleteEach(obj){
		  //현재 버튼(obj)의 상위 요소 중 가장 가까운 div 요소를 찾음
		  //div는 선택한 파일 목록을 보여주는 부분
		  const div = $(obj).closest('div');
		  
		  //div에서 'button' 태그 중 현재 버튼(obj)의 index가 몇 번째인지 확인
		  //0부터 시작
		  const index = div.find('button').index(obj);
		  const dataTransfer = new DataTransfer();
		  
		  let files = $('#roomfiles')[0].files;  //사용자가 입력한 파일을 변수에 할당
		  
		  let fileArray = Array.from(files);  //변수에 할당된 파일을 배열로 변환(FileList -> Array)
		  
		  fileArray.splice(obj, 1); //해당하는 index의 파일을 배열에서 제거
		  
		  fileArray.forEach(file => { dataTransfer.items.add(file); });
		  //남은 배열을 dataTransfer로 처리(Array -> FileList)
		  
		  $('#roomfiles')[0].files = dataTransfer.files; //제거 처리된 FileList를 돌려줌
		  
		  div.empty();
		  alert('해당 첨부 파일이 삭제되었습니다.');
  }

	function fnRoomFileCheck() {
        $('#roomfiles').change((ev) => {
          $('#roomattached_list').empty();
          let maxSize = 1024 * 1024 * 100;
          let maxSizePerFile = 1024 * 1024 * 10;
          let totalSize = 0;
          let files = ev.target.files;
          for(let i = 0; i < files.length; i++){
            totalSize += files[i].size;
            if(files[i].size > maxSizePerFile){
              alert('각 첨부파일의 최대 크기는 10MB입니다.');
              $(ev.target).val('');
              $('#roomattached_list').empty();
              return;
            }
            $('#roomattached_list').append('<div>' + files[i].name + '<button type="button" class="each" onclick="fndeleteEach(this);" style="border:none; background-color: white; margin-left:4px;"><i class="fa-regular fa-circle-xmark ico_remove_attach"></i></button></div>');
          }
          if(totalSize > maxSize){
            alert('전체 첨부파일의 최대 크기는 100MB입니다.');
            $(ev.target).val('');
            $('#roomattached_list').empty();
            return;
          }
        })
      }    
  
 fnRoomFileCheck(); 
</script>

	
	
</body>
</html>

