<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{/layout/header::head('호텔작성')}"></head> <!-- 이거 알맞게 바꿔주세요-->
<style>
.modal-body {
  border: thick double darkgray ;
}
input {
  margin-bottom: 10px;
}  

label {
  text-align: left;
}
  
</style>
<body>
  
	<div th:replace="~{/layout/header::header}"></div>
	
	<div class="main_wrap">
	
		 <div class="container text-center">
		  <div class="row">
		    <div class="col-1">	      
		    </div>
		    <div class="col-10" style="border:1px gray dotted">
		      	<!--/*여기에 작성/ 다 만들고 style 지워주세요  */-->
				   <h2>호텔 게시글작성</h2>
			<form method="post" id="hotel_add" th:action="@{/hotel/addHotel.do}"  enctype="multipart/form-data" >
				<input type="hidden" id="hotelNo" name="hotelNo" th:value="${hotelNo}">
				<div style="margin: 30px 270px;" class="w-50 p-3">
		    <div style="text-align: left;">
		      <label for="files" class="form-label" style="font-weight: 500;">메인첨부(mainList 파일이름이 목록에서 보여집니다)</label>
		      <input type="file" name="files" id="files" class="form-control" accept="image/*" multiple> <button type="button" onclick="deleteAll(this)">전체삭제</button>
		    </div>
  		  <div class="attached_list mt-2" id="attached_list"></div>
  		  <div style="text-align: left;">
         <label for="hotelName" class="form-label" style="font-weight: 500;">호텔 이름 </label> 
         <input type="text" id="hotelName" class="form-control" name="hotelName">
        </div>
		    <div><!-- 추천라디오 및 선택박스 -->
        <div style="display: flex; justify-content: space-between; align-items: center;">
        <!-- 추천라디오 -->
        <div style="text-align: left;">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="recommendStatus" th:value="1">
                <label class="form-check-label" for="recommendStatus">
                    추천
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="recommendStatus"  th:value="0" checked>
                <label class="form-check-label" for="recommendStatus">
                    안추천
                </label>
            </div>
        </div>
        <div style="text-align: left;">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="status" th:value="1"checked>
                <label class="form-check-label" for="status">
                    게시
                </label>
            </div>
            <div style="text-align: left;">
                <input class="form-check-input" type="radio" name="status"  th:value="0" >
                <label class="form-check-label" for="status">
                    안게시
                </label>
            </div>
        </div>
        
           <div class="w-25 p-3">
			    <select id="regionSelect" class="form-select" aria-label="Default select example" name="regionNo">
			        <option selected>-지역-</option>
			        <option th:each="region : ${region}" th:value="${region.regionNo}" th:text="${region.regionName}"></option>
			    </select>
		    </div>
		  </div>
		</div>
		
		<div style="text-align: left;">
      <label for="hEmail" class="form-label" style="font-weight: 500;" >Email</label>
      <input type="email" id="hEmail" class="form-control" name="hEmail">
    </div>
		<div style="text-align: left;">
      <label for="phoneNumber" id="phoneNumber" class="form-label" onfocus="fnCheckPhoneNumber();" style="font-weight: 500;">대표번호</label>
      <input type="text" id="phoneNumber" class="form-control" name="phoneNumber" placeholder="'-' 제외하고 입력해 주세요">
      <div id="phoneText"></div>
    </div>
    <div class="row mb-2">
          <label for="postcode" class="col-form-label" style="font-weight: 500;">주소</label>
          <div class="col-4"><input type="text" name="postcode" id="postcode" class="form-control" onclick="execDaumPostcode()" placeholder="우편번호" readonly></div>
          <div class="col-8" style="text-align: right;"><input type="button" class="btn btn-outline-success" onclick="execDaumPostcode()" value="우편번호 찾기"></div>
        </div>
        
        <div class="row mb-2">
          <div class="col-sm-6"><input type="text" name="hotelAddress" id="roadAddress" class="form-control" placeholder="도로명주소" readonly></div>
          <div class="col-sm-6"><input type="text" name="jibunAddress" id="jibunAddress" class="form-control" placeholder="지번주소" readonly></div>
          <input type="hidden" name="latitude" id="latitude">
          <input type="hidden" name="longitude" id="longitude"  >
        </div>
        <div class="col-sm-12"><span id="guide" style="color:#999;display:none"></span></div>
        
    <div style="display: flex; justify-content: space-between; "><div style="font-weight: 500;">편의 시설</div>
      <label for="morning" class="form-check-label">조식</label>
      <input type="checkbox" id="morning" class="form-check-input" name="morning" value="1">
      <label for="pool" class="form-check-label">수영장</label>
      <input type="checkbox" id="pool" class="form-check-input" name="pool" value="1">
      <label for="sauna" class="form-check-label">사우나</label>
      <input type="checkbox" id="sauna" class="form-check-input" name="sauna" value="1">
      <label for="lounge" class="form-check-label">라운지</label>
      <input type="checkbox" id="lounge" class="form-check-input" name="lounge" value="1">
      <label for="roomservice" class="form-check-label">룸서비스</label>
      <input type="checkbox" id="roomservice" class="form-check-input" name="roomservice" value="1">
    </div>
		<div>
    <label for="hotelDetail" class="col-form-label" style="font-weight: 500;">호텔 상세</label>
    <textarea id="hotelDetail" class="form-control" name="hotelDetail" rows="10" style="margin-bottom: 10px;">체크인: 시 체크아웃: 시</textarea>
    </form> 
    <!--/* Button trigger modal */--> 
		<button type="button" class="btn btn-primary" onclick="openHotelRoom()" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
		  객실 등록하기 
		</button>
		   
		<!--/* Modal */-->
		<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
		  <div class="modal-dialog modal-lg">
		    <div class="modal-content">
		    </div>
		  </div>
		    	  </div>    
		    	  <div id="addroom">
            </div>

				    <div class="d-grid gap-2 col-6 mx-auto">
				      <button type="submit" class="btn btn-primary" style="margin: 32px;">작성완료</button>
			      </div>
				 </div>
				 
		    <div class="col-1">	      
		    </div>
		  </div>
	  </div>
	
	</div>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script th:inline="javascript">
  
   function openHotelRoom(){
    $('.modal-content').load("/hotel/addRoom.form?hotelNo="+ $('#hotelNo').val());
  }
  
  $('#temp').click(function(){
		location.href="/hotel/addRoom.form?hotelNo="+ $('#hotelNo').val();
		
	})
  
  
	          //본 예제에서는 도로명 주소 표기 방식에 대한 법령에 따라, 내려오는 데이터를 조합하여 올바른 주소를 구성하는 방법을 설명합니다.
          function execDaumPostcode() {
            new daum.Postcode({
              oncomplete: function(data) {
                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.
    
                // 도로명 주소의 노출 규칙에 따라 주소를 표시한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var roadAddr = data.roadAddress; // 도로명 주소 변수
                var extraRoadAddr = ''; // 참고 항목 변수
    
                // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
                  extraRoadAddr += data.bname;
                }
                // 건물명이 있고, 공동주택일 경우 추가한다.
                if(data.buildingName !== '' && data.apartment === 'Y'){
                  extraRoadAddr += (extraRoadAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                }
                // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                if(extraRoadAddr !== ''){
                  extraRoadAddr = ' (' + extraRoadAddr + ')';
                }
    
                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                document.getElementById('postcode').value = data.zonecode;
                document.getElementById("roadAddress").value = roadAddr;
                document.getElementById("jibunAddress").value = data.jibunAddress;
                
                var geocoder = new kakao.maps.services.Geocoder();

                var callback = function(result, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        document.getElementById('longitude').value = result[0].x;
                        document.getElementById('latitude').value = result[0].y;
                        console.log(result);
                        console.log(result[0].x);
                    }
                };
                  geocoder.addressSearch(roadAddr, callback);

                var guideTextBox = document.getElementById("guide");
                // 사용자가 '선택 안함'을 클릭한 경우, 예상 주소라는 표시를 해준다.
                if(data.autoRoadAddress) {
                  var expRoadAddr = data.autoRoadAddress + extraRoadAddr;
                  guideTextBox.innerHTML = '(예상 도로명 주소 : ' + expRoadAddr + ')';
                  guideTextBox.style.display = 'block';
                } else if(data.autoJibunAddress) {
                  var expJibunAddr = data.autoJibunAddress;
                  guideTextBox.innerHTML = '(예상 지번 주소 : ' + expJibunAddr + ')';
                  guideTextBox.style.display = 'block';
                } else {
                  guideTextBox.innerHTML = '';
                  guideTextBox.style.display = 'none';
                }
              }
            }).open();
          }
 const deleteAll = () => {
    $('#files').val('');
     $('#attached_list').empty();
 }
 
  // 개별 파일의 삭제 버튼에 적용할 메소드
  const deleteEach = (obj) => {
  //현재 버튼(obj)의 상위 요소 중 가장 가까운 div 요소를 찾음
  //div는 선택한 파일 목록을 보여주는 부분
  const div = $(obj).closest('div');
  
  //div에서 'button' 태그 중 현재 버튼(obj)의 index가 몇 번째인지 확인
  //0부터 시작
  const index = div.find('button').index(obj);
  const dataTransfer = new DataTransfer();
  
  let files = $('#files')[0].files;  //사용자가 입력한 파일을 변수에 할당
  
  let fileArray = Array.from(files);  //변수에 할당된 파일을 배열로 변환(FileList -> Array)
  
  fileArray.splice(obj, 1); //해당하는 index의 파일을 배열에서 제거
  
  fileArray.forEach(file => { dataTransfer.items.add(file); });
  //남은 배열을 dataTransfer로 처리(Array -> FileList)
  
  $('#files')[0].files = dataTransfer.files; //제거 처리된 FileList를 돌려줌
  
  div.empty();
 }



	const fnFileCheck = () => {
        $('#files').change((ev) => {
          $('#attached_list').empty();
          let maxSize = 1024 * 1024 * 100;
          let maxSizePerFile = 1024 * 1024 * 10;
          let totalSize = 0;
          let files = ev.target.files;
          for(let i = 0; i < files.length; i++){
            totalSize += files[i].size;
            if(files[i].size > maxSizePerFile){
              alert('각 첨부파일의 최대 크기는 10MB입니다.');
              $(ev.target).val('');
              $('#attached_list').empty();
              return;
            }
            $('#attached_list').append('<div>' + files[i].name + '<button type="button" class="each" onclick="deleteEach(this)">X</button></div>');
          }
          if(totalSize > maxSize){
            alert('전체 첨부파일의 최대 크기는 100MB입니다.');
            $(ev.target).val('');
            $('#attached_list').empty();
            return;
          }
        })
      }
      
  function fnCheckPhoneNumber(){
    let phoneNumber = $('#phoneNumber').val();
    let regPhoneNumber = /^\d{2,3}-\d{3,4}-\d{4}$/; 
     if (!regPhoneNumber.test(phoneNumber)){
    $('#phoneText').text('올바른 전화번호를 입력해주세요');
    return;  
    }    
  }
	

	const myModalEl = document.getElementById('staticBackdrop')
	var hotelNo = $('#hotelNo').val();
	
  myModalEl.addEventListener('hidden.bs.modal', event => {
    $.ajax({
        type: 'get',
        url: '/hotel/roomList.do',
        data: {hotelNo : hotelNo},
        dataType: 'json',
        success: (resData) => {  
                    console.log(resData);
                  /*       
                <input type="hidden" th:id="${'roomNo' + roomTypeStat.count}" th:value="${roomType.roomNo}">
                <div class="border rounded-1">
                <div class="row">
                  <div class="col-3">
                    <div th:id="${'roomCarousel' + roomTypeStat.count}" class="carousel slide">
                      <div class="carousel-inner">
                        <th:block th:each="roomImage : ${hotelImage}">
                            <div th:if="${roomImage.roomNo == roomType.roomNo}" class="carousel-item">
                               <img th:src="@{|${roomImage.imagePath}/${roomImage.filesystemName}|}" class="d-block w-100" >
                            </div>
                        </th:block>
                        
                      </div>
                      <button class="carousel-control-prev" type="button" th:data-bs-target="${'#roomCarousel' + roomTypeStat.count}" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                      </button>
                      <button class="carousel-control-next" type="button" th:data-bs-target="${'#roomCarousel' + roomTypeStat.count}" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                      </button>
                    </div>
                    <div th:text="|침대 : ${roomType.bed}|"></div>
                    <div th:text="|전망 : ${roomType.rView}|"></div>
                    <div th:text="|허용인원 : ${roomType.people} 명|"></div>
                    <div th:if="${roomType.bleakfast == 0}">조식 : <i class="fa-solid fa-x" style="color: #96b2c5;"></i></div>
                    <div th:if="${roomType.bleakfast == 1}">조식 : <i class="fa-sharp fa-solid fa-o" style="color: #96b6c5;"></i></div>
                    <div th:if="${roomType.smoke == 0}">흡연 : <i class="fa-solid fa-x" style="color: #96b2c5;"></i></div>
                    <div th:if="${roomType.smoke == 1}">흡연 : <i class="fa-sharp fa-solid fa-o" style="color: #96b6c5;"></i></div>
                    <div th:text="|${roomType.shower}|"></div>
                    <div th:text="|방크기 : ${roomType.rSize}|"></div>
                  </div>
                  <div class="col-6">
                    <div  th:class="${'roomName'+roomTypeStat.count}" id="roomName" th:text="${roomType.roomName}" th:value="${roomType.roomName}"></div>
                    <div th:text="${roomType.roomDetail}" style="border-top: 1px #9399a5 solid;"></div>
                    
                    <th:block th:each="feature : ${roomFeature}">
                      <div class="border rounded-1" th:if="${feature.roomNo == roomType.roomNo}">
                          <div>객실 시설</div>
                        <div class="roomFac">
                          <div th:if="${feature.water == 0}"><i class="fa-solid fa-bottle-water fa-2xl" style="color: #9399a5;"></i><div>물</div></div>
                          <div th:if="${feature.water == 1}"><i class="fa-solid fa-bottle-water fa-2xl" style="color: #2f7fa7;"></i><div>물</div></div>
                          <div th:if="${feature.coffee == 0}"><i class="fa-solid fa-mug-saucer fa-2xl" style="color: #9399a5;"></i><div>커피</div></div>
                          <div th:if="${feature.coffee == 1}"><i class="fa-solid fa-mug-saucer fa-2xl" style="color: #2f7fa7;"></i><div>커피</div></div>
                          <div th:if="${feature.drier == 0}"><i class="fa-solid fa-wind fa-2xl" style="color: #9399a5;"></i><div>드라이어</div></div>
                          <div th:if="${feature.drier == 1}"><i class="fa-solid fa-wind fa-2xl" style="color: #2f7fa7;"></i><div>드라이어</div></div>
                          <div th:if="${feature.towel == 0}"><i class="fa-solid fa-rug fa-2xl" style="color: #9399a5;"></i><div>수건</div></div>
                          <div th:if="${feature.towel == 1}"><i class="fa-solid fa-rug fa-2xl" style="color: #2f7fa7;"></i><div>수건</div></div>
                          <div th:if="${feature.minibar == 0}"><i class="fa-solid fa-martini-glass fa-2xl" style="color: #9399a5;"></i><div>미니바</div></div>
                          <div th:if="${feature.minibar == 1}"><i class="fa-solid fa-martini-glass fa-2xl" style="color: #2f7fa7;"></i><div>미니바</div></div>
                          <div th:if="${feature.iron == 0}"><i class="fa-solid fa-shirt fa-2xl" style="color: #9399a5;"></i><div>다리미</div></div>
                          <div th:if="${feature.iron == 1}"><i class="fa-solid fa-shirt fa-2xl" style="color: #2f7fa7;"></i><div>다리미</div></div>
                      </div>
                      </div>
                    </th:block>
                  </div>
                  <div class="col-3" style="margin-right: 0;">
                    <th:block th:each="price : ${price}">
                      <th:block th:if="${price.roomNo == roomType.roomNo}">
                        <th:block th:if="${price.bsDate <= #calendars.format(#calendars.createNow(), 'yyyy/MM/dd') && price.beDate >= #calendars.format(#calendars.createNow(), 'yyyy/MM/dd')}">
                          <div th:text="|비수기 : ${price.bsDate} ~ ${price.beDate}|"></div>
                          <div th:text="|${price.biPrice}원|"> </div>
                        </th:block>
                        <th:block th:if="${price.jsDate <= #calendars.format(#calendars.createNow(), 'yyyy/MM/dd') && price.jeDate >= #calendars.format(#calendars.createNow(), 'yyyy/MM/dd')}">
                          <div th:text="|준성수기 : ${price.jsDate} ~ ${price.jeDate}|"></div>
                          <div th:text="|${price.junPrice}원|"> </div>
                        </th:block>
                        <th:block th:if="${price.ssDate <= #calendars.format(#calendars.createNow(), 'yyyy/MM/dd') && price.seDate >= #calendars.format(#calendars.createNow(), 'yyyy/MM/dd')}">
                          <div th:text="|성수기 : ${price.ssDate} ~ ${price.seDate}|"></div>
                          <div th:text="|${price.sungPrice}원|"> </div>
                        </th:block>
                      </th:block>
                    </th:block>
                    <div><button type="button" class="btn-choice" th:attr="data-roomno=${'roomNo' + roomTypeStat.count}" onclick="selectRoom(this.getAttribute('data-roomno'))">선택</button></div>
                    <div th:text="|남은방 : ${roomType.roomMany - countReserveRoom[roomTypeStat.index]} 개| "></div>
                  </div>
                </div>
              </div>
              </th:block>  
            </div>
          */
          
        }
    })
  })
	
	
	
	
	
	
	
	fnFileCheck();
	 
</script>
	
	
	
	<div th:replace="~{/layout/footer::footer}"></div>
</body>
</html>

