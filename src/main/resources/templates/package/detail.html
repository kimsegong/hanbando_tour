<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{/layout/header::head('íŒ¨í‚¤ì§€ìƒí’ˆ')}"></head>
<style>
  .btn-zero {
    color:white;
      } 
  .btn-kong1 {
    background-color: #164863;
    color:white;
      } 
  .choice{
    box-sizing: border-box;
    margin: 0px 0px 28px;
    min-width: 0px;
    line-break: anywhere;
    font-size: 20px;
    letter-spacing: -0.02em;
    line-height: 30px;
    font-weight: 700;
    border-bottom: 1px solid rgb(0, 0, 0);
    width: 100%;
    text-align: left;
    justify-content: space-between;
    padding: 8px 16px;
    margin-top: 80px;
} 
.reserveNo, .reserveUserNo {
        display: none;
    }
 #myform fieldset{
    display: inline-block;
    direction: rtl;
    border:0;
}
#myform fieldset legend{
    text-align: right;
}
#myform input[type=radio]{
    display: none;
}
#myform label{
    font-size: 3em;
    color: transparent;
    text-shadow: 0 0 0 #f0f0f0;
}
#myform label:hover{
    text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
}
#myform label:hover ~ label{
    text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
}
#myform input[type=radio]:checked ~ label{
    text-shadow: 0 0 0 rgba(250, 208, 0, 0.99);
}
 .contents {
    width: 80%;
    margin: auto;
 }
 img {
  max-width: 100%;
  height: auto;
 }
 /* í…ìŠ¤íŠ¸ ê¹œë¹¡ì„ */
@keyframes blink-effect { 50% { opacity: 0; } } 
.blink { 
    animation: blink-effect 1s step-end infinite; 
}
</style>
<body>
  <div th:replace="~{/layout/header::header}"></div>
        <th:block th:if="${session.user != null}">
         <th:block th:if="${session.user.auth == 0}">
         <form id="frm_btn" method="post">
            <input type="text" name="packageNo" class="heart" th:value="${packageDto.packageNo}">  
            <input type="hidden" name="regionNo" th:value="${packageDto.regionDto.regionNo}">
            <input type="hidden" name="themeNo" th:value="${packageDto.themeDto.themeNo}">
            <input type="hidden" name="packageTitle" th:value="${packageDto.packageTitle}">
            <input type="hidden" name="miniOne" th:value="${packageDto.miniOne}">
            <input type="hidden" name="miniTwo" th:value="${packageDto.miniTwo}">
            <input type="hidden" name="miniThree" th:value="${packageDto.miniThree}">
            <input type="hidden" name="packagePlan" th:value="${packageDto.packagePlan}">
            <input type="hidden" name="packageContents" th:value="${packageDto.packageContents}">
            <input type="hidden" name="hotelContents" th:value="${packageDto.hotelContents}">
            <input type="hidden" name="price" th:value="${packageDto.price}">       
            <input type="hidden" name="danger" th:value="${packageDto.danger}">
            <input type="hidden" name="packagePlan" th:value="${packageDto.packagePlan}">                  
            <input type="hidden" name="maxPeople" th:value="${packageDto.maxPeople}">
            <input type="hidden" name="recommendStatus" th:value="${packageDto.recommendStatus}">
           <button type="button" id="btn_edit">í¸ì§‘</button> 
           <button type="button" id="btn_remove">ì‚­ì œ</button> 
         </form>
         </th:block>
         </th:block>
         
  <div class="container text-center">
   <div class="row">
    <div class="col-8">
      <div th:each="atc, iterStat : ${attachList.attachList}">
          <input type="hidden" id="attach" th:value="${attachList.attachList}">
          <img th:if="${atc.thumbnail == 1}" 
               th:src="@{|${atc.imagePath}/${atc.filesystemName}|}" class="img-fluid">
      </div>
	  <div style="text-align: left;" th:text="|ì¡°íšŒìˆ˜ : ${#numbers.formatInteger(packageDto.hit, 1, 'COMMA')}|"></div>
      <div>
       <div class="choice">ì—¬í–‰ ì£¼ìš”ì¼ì •</div>
       <div style="text-align: left;" th:text="${packageDto.packagePlan}"></div>
       <div style="text-align: left;" th:text="|${packageDto.maxPeople} ëª…|"></div>
      <!-- ëª¨ë‹¬ ë²„íŠ¼ -->
      <div class="col-12 text-end">
       <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#exampleModal">
        ì—¬í–‰ì‹œ ìœ ì˜ì‚¬í•­
       </button>
      </div>
      <!-- ëª¨ë‹¬ì°½ -->
      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">ì—¬í–‰ì‹œ ìœ ì˜ì‚¬í•­</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" th:text="${packageDto.danger}">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
            </div>
          </div>
        </div>
      </div>
      </div>
      <!-- ì—¬í–‰ì¥ì†Œ -->      
      <div>
       <div class="choice">ì—¬í–‰ ìƒì„¸ì‚¬í•­</div>
       
       <ul class="nav nav-tabs" id="myTab" role="tablist">
         <li class="nav-item" role="presentation">
           <button
              class="nav-link active"
              id="home-tab" 
              data-bs-toggle="tab"
              data-bs-target="#home-tab-pane" 
              type="button"
              role="tab"
              aria-controls="home-tab-pane"
              aria-selected="true"
          >íŒ¨í‚¤ì§€ì •ë³´
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
              class="nav-link"
              id="profile-tab"
              data-bs-toggle="tab"
              data-bs-target="#profile-tab-pane"
              type="button"
              role="tab"
              aria-controls="profile-tab-pane"
              aria-selected="false"
          >í˜¸í…”ì •ë³´
          </button>
        </li>
       </ul>
      </div>
       <div class="tab-content" id="myTabContent" style="text-align: left;">
          <div
            class="tab-pane fade show active contents"
            id="home-tab-pane"
            role="tabpanel"
            aria-labelledby="home-tab" th:utext="${packageDto.packageContents}"></div>     
          <div
            class="tab-pane fade"
            id="profile-tab-pane"
            role="tabpanel"
            aria-labelledby="profile-tab" th:text="${packageDto.hotelContents}"></div>
        </div>        
        <th:block th:if="${session.user != null}">
        <input type="hidden" name="userNo" id="userNo" th:value="${session.user.userNo}">
        </th:block>
        <div th:each="reservation : ${reserve}">
            <div class="reserveNo" th:text="${reservation.reserveNo}|"th:value="${reservation.reserveNo}"></div>
            <div class="reserveUserNo" th:text="${reservation.userDto.userNo}" th:value="${reservation.userDto.userNo}"></div>
        </div>
        
        <div class="choice">ì—¬í–‰ í›„ê¸°</div>
        
          <form class="mb-3 frm_review_add" method="post">
          <div id="myform">
          <fieldset>
            <span class="text-bold"> â¤ï¸ ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”</span>
            <input type="radio" name="star" th:value="5" id="rate1"><label
              for="rate1">â˜…</label>
            <input type="radio" name="star" th:value="4" id="rate2"><label
              for="rate2">â˜…</label>
            <input type="radio" name="star" th:value="3" id="rate3"><label
              for="rate3">â˜…</label>
            <input type="radio" name="star" th:value="2" id="rate4"><label
              for="rate4">â˜…</label>
            <input type="radio" name="star" th:value="1" id="rate5"><label
              for="rate5">â˜…</label>
          </fieldset>
              <input type="hidden" name="packageNo" th:value="${packageDto.packageNo}">
            <div>                          
              <textarea class="col-auto form-control" name="reviewContents" placeholder="í–‰ë³µí–ˆë˜ ì—¬í–‰í›„ê¸°ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”ğŸ™‚"></textarea>   <!-- ì˜ˆì•½í•œì‚¬ëŒë§Œ ë³´ì´ê²Œ -->
              <button type="button" class="btn btn-kong" id="btn_review_add" style="margin-top: 20px; margin-left: 750px">ì‘ì„±ì™„ë£Œ</button>
            </div>
            </div>
           </form>
           
            
          <div style="overflow: hidden;">
           <div id="starAve" style="text-align: left;">ë¦¬ë·°í‰ì </div>
            <div style="height: 100px; float: right;">
                <select id="sortReview" class="form-select form-select-sm mb-3 h-50 d-inline-block" style="width: 120px;" aria-label=".form-select-sm example">
                    <option value="1" selected>ìµœì‹ ìˆœ</option>
                    <option value="2">ë³„ì ìˆœ</option>
                </select>
            </div>
        </div>
        <div id="reviewAccordion">
             <input type="hidden" id="packageNo" name="packageNo" th:value="${packageDto.packageNo}">     
             
        </div>  
    </div>    

    
    
    <div class="col-4">
      <div class="w3-sidebar w3-bar-block" style="width:100%; height: 500px;"> <!-- ì‚¬ì´ë“œë°” -->
       <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 30px;">
	    <div style="font-size: large; font-weight: bolder; text-align: left;" class="blink">ì„ íƒì¤‘ì¸ í–‰ì‚¬</div>
		    <button class="btn btn-zero position-absolute top-0 end-0" id="heartButton">
				<span class="position-absolute top-0 start-0 translate-middle badge rounded-pill bg-danger">
				    ì°œí•˜ê¸°				    
				</span>
		        <input type="hidden" id="packageNoHeart" name="packageNo" th:value="${packageDto.packageNo}">
		        <th:block th:if="${session.user != null}">
		        <input type="hidden" id="userNoHeart" name="userNo" th:value="${session.user.userNo}">
		        </th:block>
		        <div><span id="heartIcon"></span></div>
		    </button>
		</div>
		<div style="margin-top: 20px">
		    <div style="font-weight: bolder; text-align: left; font-size: 25px;" th:text="${packageDto.packageTitle}"></div>
		    <div style="font-size: 30px; text-align: right;" th:text="|${packageDto.price} ì›|"></div>
		</div>						
       <div style="text-align: left;">
         <span class="badge text-bg-success" th:text="${packageDto.miniOne}"></span>
         <span class="badge text-bg-warning" th:text="${packageDto.miniTwo}"></span>
         <span class="badge text-bg-secondary" th:text="${packageDto.miniThree}"></span>
       </div>
     <div style="margin-top: 60px; margin-left: 40%;">
	    <div> 
	        <div class="input-group date" data-provide="datepicker" style="width: 210px;">
	            <input type="text" class="form-control" id="reserve_start" style="border: none;">
	            <div class="input-group-addon">
	                <button class="btn btn-kong1">
	                    <div id="calender" style="color: white; cursor: pointer;">ì¶œë°œì¼ì„ íƒ</div>
	                </button>
	            </div>
	        </div>
	    </div>
       <button class="btn btn-kong1" id="btn_reserve" style="margin-top: 10px; margin-left: 45%;">
        <div style="color: white; cursor: pointer;">ì˜ˆì•½í•˜ëŸ¬ê°€ê¸°</div>
       </button>
      </div> 
    </div>
   </div>
  </div>
    
    
    <script th:inline="javascript">   
      
      
      $('#btn_reserve').click(function(){
        startDate = $('#reserve_start').val();
         // ë‚ ì§œê°€ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
        if (startDate.trim() === "") {
            alert("ì¶œë°œì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
            e.preventDefault();
        } else {
          
        }
      })

    
    $.fn.datepicker.dates['ko'] = {
	    days: ["ì¼ìš”ì¼", "ì›”ìš”ì¼", "í™”ìš”ì¼", "ìˆ˜ìš”ì¼", "ëª©ìš”ì¼", "ê¸ˆìš”ì¼", "í† ìš”ì¼"],
	    daysShort: ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "],
	    daysMin: ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "],
	    months: ["1ì›”", "2ì›”", "3ì›”", "4ì›”", "5ì›”", "6ì›”", "7ì›”", "8ì›”", "9ì›”", "10ì›”", "11ì›”", "12ì›”"],
	    monthsShort: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"],
	    today: "ì˜¤ëŠ˜",
	    clear: "ë‹«ê¸°",
	    format: "yyyy-mm-dd",
	    titleFormat: "yyyy MM", 
	    weekStart: 0
	   };


     $(".date").datepicker({
        language: 'ko',        // í•œê¸€
        format: 'yyyy-mm-dd',  // ë‹¬ë ¥ í¬ë§·
        autoclose: true,       // ì„ íƒ ì‹œ ìë™ ë‹«ê¸°
        minViewMode: 0,        // ìµœì†Œ ë·° ëª¨ë“œ (ì¼)
        maxViewMode: 2,        // ìµœëŒ€ ë·° ëª¨ë“œ (ë…„ë„)
        startView: 0,          // ë‹¬ë ¥ì´ ì—´ë¦¬ë©´ ì¼ë¶€í„° ì„ íƒ
        clearBtn: true,        // ë‹«ê¸° ë²„íŠ¼
        orientation: "bottom",
        startDate: new Date(), // ì˜¤ëŠ˜ë¶€í„° ì„ íƒ ê°€ëŠ¥
        endDate: '+2m'         // 2ê°œì›” ê¹Œì§€ë§Œ ì—´ì–´ë‘ 
    });


     var frmBtn = $('#frm_btn');
    
     const fnEditPackage = () => {
      $('#btn_edit').click(() => {
        frmBtn.attr('action', '/package/edit.do');
        frmBtn.submit();
      })
    }

   const fnRemovePackage = () => {
      $('#btn_remove').click(() => {
        if(confirm('íŒ¨í‚¤ì§€ë¥¼ ì‚­ì œí• ê¹Œìš”?')){
          frmBtn.attr('action', '/package/remove.do');
          frmBtn.submit();          
        }
      })
    }
   
   const fnReviewAdd = () => {
    $('#btn_review_add').click(() => {         
        // ë°ì´í„° í™•ì¸ìš©
        console.log('Review Contents:', $('textarea[name="reviewContents"]').val());
        console.log('User No:', $('#userNo').val());
        console.log('Package No:', $('input[name="packageNo"]').val());
        console.log('Reserve No:', $('input[name="reserveNo"]').val());
        console.log('Star:', $('input[name="star"]:checked').val());
        
        $.ajax({
            type: 'post',
            url: '/package/addReview.do',
            data: {
                // ë¦¬ë·° ë²ˆí˜¸ë¥¼ ë³´ë‚´ì§€ ì•ŠìŒ
                reviewContents: $('textarea[name="reviewContents"]').val(),
                userNo: $('#userNo').val(),
                packageNo: $('input[name="packageNo"]').val(),
                reserveNo: $('input[name="reserveNo"]').val(),
                star: $('input[name="star"]:checked').val()                
            },
            dataType: 'json',
            success: (resData) => {             
                console.log('Response Data:', resData); // ì½˜ì†”ì— ì‘ë‹µ ë°ì´í„° ì¶œë ¥
                if (resData.addReviewResult === 1) {
                    alert('ë¦¬ë·°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    $('#reviewContents').val('');
                    fnReviewList();
                } else {
                    alert('ë¦¬ë·° ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            },
            error: (xhr, status, error) => {
                console.error('AJAX Error:', error);
                alert('AJAX ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });
    });
}


    var page = 1;
    var totalPage = 0;
  
    const packageNo = $('#packageNo').val();
  
    const fnReviewList = () => { 
      $.ajax({
        type: 'get',
        url: '/package/reviewList.do',
        data: { page: page, packageNo: packageNo},
        dataType: 'json',
        success: (resData) => {
          totalPage = resData.totalPage;
          $('#reviewAccordion').empty();
          const sessionUserNo = $('#userNo').val();
          if (resData.reviewList != null && resData.reviewList.length > 0) {
            $.each(resData.reviewList, (i, review)=> {
              let str = '<div class="accordion accordion-flush">';
              str += '<div class="accordion-item">';
              str += '<h2 class="accordion-header">';
              str += '<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse' + i + '" aria-expanded="false" aria-controls="flush-collapse' + i + '">' + review.userDto.name + 'ë‹˜ì˜ ë¦¬ë·°  ' + generateStarRating(review.star) + '</button>';
              str += '</h2>';
              str += '<div id="flush-collapse' + i + '" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">';
              str += '<div class="accordion-body">' + review.reviewContents + '</div>';
              str += '  <div>';
              if(sessionUserNo == review.userDto.userNo){                
                    str += '  <input type="hidden" value="' + review.reviewNo + '">';
                    str += '  <button type="button" class="btn remove_Review" style="margin-left: 550px;">ì‚­ì œí•˜ê¸°</button>';
                  }
                    str += '  </div>';
              str += '</div>';
              str += '</div>';
              str += '</div>';
                $('#reviewAccordion').append(str);         
            });
          } else {
            $('#reviewAccordion').append('<div class="text-center">ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>');
          }
        },
        error: (error) => {
          console.error('Ajax ìš”ì²­ ì—ëŸ¬:', error);
        }
      });
    };
    
	   $('#sortReview').change(function () {
      const selectedOption = $(this).val();
    
      if (selectedOption === '2') {
         fnReviewStarList();
      } else {
         fnReviewList();
      }
      });	
	
    const fnReviewStarList = () => { 
      $.ajax({
        type: 'get',
        url: '/package/reviewStarList.do',
        data: { page: page, packageNo: packageNo},
        dataType: 'json',
        success: (resData) => {
          totalPage = resData.totalPage;
          $('#reviewAccordion').empty();
          const sessionUserNo = $('#userNo').val();
          if (resData.reviewList != null && resData.reviewList.length > 0) {
            $.each(resData.reviewList, (i, review)=> {
              let str = '<div class="accordion accordion-flush">';
              str += '<div class="accordion-item">';
              str += '<h2 class="accordion-header">';
              str += '<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse' + i + '" aria-expanded="false" aria-controls="flush-collapse' + i + '">' + review.userDto.name + 'ë‹˜ì˜ ë¦¬ë·°  ' + generateStarRating(review.star) + '</button>';
              str += '</h2>';
              str += '<div id="flush-collapse' + i + '" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">';
              str += '<div class="accordion-body">' + review.reviewContents + '</div>';
              str += '  <div>';
              if(sessionUserNo == review.userDto.userNo){                
                    str += '  <input type="hidden" value="' + review.reviewNo + '">';
                    str += '  <button type="button" class="btn remove_Review" style="margin-left: 550px;">ì‚­ì œí•˜ê¸°</button>';
                  }
                    str += '  </div>';
              str += '</div>';
              str += '</div>';
              str += '</div>';
                $('#reviewAccordion').append(str);         
            });
          } else {
            $('#reviewAccordion').append('<div class="text-center">ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>');
          }
        },
        error: (error) => {
          console.error('Ajax ìš”ì²­ ì—ëŸ¬:', error);
        }
      });
    };
	
    	 $(document).ready(function() {
        var sessionUserNo = $('#userNo').val();
        var reserveUserNos = [];
  
        $('.reserveNo').each(function() {
            var reservationUserNo = $(this).next('.reserveUserNo').text();
            reserveUserNos.push(reservationUserNo);
        });    
        var matchingUserNo = reserveUserNos.filter(function(userNo) {
            return userNo === sessionUserNo;
        })[0];
        if (matchingUserNo) {
            $('#myform').show();
        } else {
            $('#myform').hide();
        }
    });
     
      $(document).ready(function() {
          $.ajax({
              type: 'post',
              url: '/package/getAverageRating.do',
              data: {
                  packageNo: $('input[name="packageNo"]').val()
              },
              dataType: 'json',
              success: function(resData) {
                  updateAverageRating(resData.averageRating);
              },
              error: function(xhr, status, error) {
                  console.error('AJAX Error:', error);
                  alert('í‰ê·  ë³„ì  ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
              }
          });
      });
      
      function updateAverageRating(averageRating) {
          var displayText = averageRating ? 'í‰ê·  ë³„ì : ' + averageRating.toFixed(0) : 'í‰ì  : 0';
          $('#starAve').text(displayText);
      }


    const fnReviewRemove = () => {
      $(document).on('click', '.remove_Review', (ev) => {
        if(!confirm('ë¦¬ë·°ë¥¼ ì‚­ì œí• ê¹Œìš”?')){
          return;
        }
        $.ajax({
          // ìš”ì²­
          type: 'post',
          url: '/package/removeReview.do',
          data: 'reviewNo=' + $(ev.target).prev().val(),
          // ì‘ë‹µ
          dataType: 'json',
          success: (resData) => { 
            if(resData.removeResult === 1){
              alert('í•´ë‹¹ ë¦¬ë·°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
              fnReviewList();
            } else {
              alert('ë¦¬ë·°ê°€ ì‚­ì œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }
          }
        })
      })
    }
    
    
    function generateStarRating(star) {
    let stars = '';
    for (let i = 1; i <= 5; i++) {
        if (i <= star) {
            stars += '<i class="fa-solid fa-star" style="color: #ede502;"></i>'; 
        } else {
            stars += '<i class="fa-regular fa-star" style="color: #f0c424;"></i>'; 
        }
    }
    return stars;
}

     // ì˜ˆì•½ë„˜ì–´ê°€ê¸°#####
    const fnReserveClick = () => {
    $('#btn_reserve').click(() => {
        let user = /*[[${session.user}]]*/ null;
        if (user === null) {
            if (confirm('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ë¡œê·¸ì¸í• ê¹Œìš”?')) {
                location.href = '/user/login.form';
            } else {
                return;
            }
          } else {
              fnGoReserve();
          }
      })
  }

    function fnGoReserve() {
        location.href = '/reserve/write.form?packageNo=[[${packageDto.packageNo}]]&resStart=' + $('#reserve_start').val();
    }
       

  
   // ì°œí•˜ê¸°#####
    $(document).ready(function () {
      // ì´ˆê¸° ë¡œë”© ì‹œ ì°œ ì—¬ë¶€ í™•ì¸ ë° ì•„ì´ì½˜ ì„¤ì •
      checkHeart();
  
      $('#heartButton').on('click', function () {
          addHeart();
      });
  });
   function addHeart() {
    var user = /*[[${session.user}]]*/ null;

    // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš°
    if (user === null) {
        if (confirm('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ë¡œê·¸ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            location.href = '/user/login.form';
        }
        return;
    }

    var packageNo = $('#packageNoHeart').val();
    var userNo = $('#userNoHeart').val();

    // ì°œ ì—¬ë¶€ í™•ì¸
    $.ajax({
        type: 'get',
        url: '/package/checkHeart.do',
        data: {
            packageNo: packageNo,
            userNo: userNo
        },
        success: function (response) {
            console.log('ì°œ ì—¬ë¶€ í™•ì¸ ê²°ê³¼:', response); // í™•ì¸ìš© ë¡œê·¸
            if (response.enableHeart) {
                // ì´ë¯¸ ì°œí•œ ê²½ìš° ì°œì„ í•´ì œ
                removeHeart();
            } else {
                // ì°œí•˜ì§€ ì•Šì€ ê²½ìš° ì°œì„ ì¶”ê°€
                $.ajax({
                    type: 'post',
                    url: '/package/heartPackage.do',
                    data: {
                        packageNo: packageNo,
                        userNo: userNo
                    },
                    success: function () {
                        console.log('ì°œí•˜ê¸° ì„±ê³µ');
                        checkHeart(); // ì°œ ì—¬ë¶€ ì¬í™•ì¸
                    },
                    error: function (error) {
                        console.error('ì°œí•˜ê¸° ì‹¤íŒ¨:', error);
                    }
                });
            }
        },
        error: function (error) {
            console.error('ì°œ ì—¬ë¶€ í™•ì¸ ì‹¤íŒ¨:', error);
        }
    });
}

    function removeHeart() {
    var user = /*[[${session.user}]]*/ null;

    // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš°
    if (user === null) {
        if (confirm('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ë¡œê·¸ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            location.href = '/user/login.form';
        }
        return;
    }

    var packageNo = $('#packageNoHeart').val();
    var userNo = $('#userNoHeart').val();

    // ì°œì„ í•´ì œí•˜ëŠ” ë¡œì§
    $.ajax({
        type: 'post',
        url: '/user/removeHeart.do',
        data: {
            packageNo: packageNo,
            userNo: userNo
        },
        success: function () {
            console.log('ì°œ ì·¨ì†Œ ì„±ê³µ');
            checkHeart(); 
        },
        error: function (error) {
            console.error('ì°œ ì·¨ì†Œ ì‹¤íŒ¨:', error);
        }
    });
}

    function checkHeart() {
    var packageNo = $('#packageNoHeart').val();
    var userNo = $('#userNoHeart').val();

    // ì°œ ì—¬ë¶€ í™•ì¸
    $.ajax({
        type: 'get',
        url: '/package/checkHeart.do',
        data: {
            packageNo: packageNo,
            userNo: userNo
        },
        success: function (response) {
            console.log('ì°œ ì—¬ë¶€ í™•ì¸ ê²°ê³¼:', response); 
            if (response.enableHeart) {
                // ì´ë¯¸ ì°œí•œ ê²½ìš° ì•„ì´ì½˜ ë³€ê²½
                $('#heartIcon').html('<i class="fa-solid fa-heart" style="color: #bd1414; font-size: 24px;"></i>');
            } else {
                // ì°œí•˜ì§€ ì•Šì€ ê²½ìš° ì•„ì´ì½˜ ë³€ê²½
                $('#heartIcon').html('<i class="fa-regular fa-heart" style="color: #fb3c3c; font-size: 24px;"></i>');
            }
        },
        error: function (error) {
            console.error('ì°œ ì—¬ë¶€ í™•ì¸ ì‹¤íŒ¨:', error);
        }
    });
}


   fnEditPackage();
   fnRemovePackage();
   fnReviewAdd();
   fnReviewList();
   fnReviewRemove();
   fnReserveClick();

   
  </script>

  
  <div th:replace="~{/layout/footer::footer}"></div>
</body>
</html>

