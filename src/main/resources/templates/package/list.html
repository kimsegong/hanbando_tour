<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

 <head th:replace="~{/layout/header::head('íŒ¨í‚¤ì§€ìƒí’ˆë¦¬ìŠ¤íŠ¸')}"></head>
<style>
  .card {
      width: 18rem;
      margin-bottom: 20px;
  }

  .admin_btn {
      display: flex;
      justify-content: flex-end;
  }
  
  .btn-kong {
    background-color: #96B6C5;
    color:white;
      }
  .card-title {
    font-size: 20px;
    font-weight: 400;
  }
  .btn-outline-kong {
    color: rgb(23, 62, 104);
  } 
  .card-img-top {
        height: 200px; /* ì›í•˜ëŠ” ì¹´ë“œ ì´ë¯¸ì§€ ë†’ì´ */
        object-fit: cover; /* ì´ë¯¸ì§€ê°€ ì¹´ë“œì— ë§ê²Œ ì¡°ì ˆë  ìˆ˜ ìˆë„ë¡ ì„¤ì • */
        width: 100%; /* ê°€ë¡œ í¬ê¸°ë¥¼ 100%ë¡œ ì„¤ì •í•˜ì—¬ ì¹´ë“œ ì•ˆì— ê½‰ ì°¨ê²Œ í•¨ */
    }
  hr {
    border-top: 3px solid black; /* ë‘ê»˜ ì¡°ì ˆ ê°€ëŠ¥ */
    margin: 20px 0; /* í•„ìš”ì— ë”°ë¼ ë§ˆì§„ ì¡°ì ˆ ê°€ëŠ¥ */
  }

</style>  
<body>

  <div th:replace="~{/layout/header::header}"></div>

  <div class="container text-center">  <!-- ê·¸ë¦¬ë“œ ì‹œì‘ -->  
  <div class="row">
    <div class="col-1">    
    </div>
    <div class="col-10" >
    <th:block th:if="${session.user != null}">
     <th:block th:if="${session.user.auth == 0}">
      <a th:href="@{/package/write.form}">
        <button type="button" class="admin_btn" style="margin-left: auto;">ê²Œì‹œê¸€ ì‘ì„±</button>
      </a> 
     </th:block>
   </th:block>
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div style="display: inline-block;"> 
         <span id="count"></span>ê°œì˜ ìƒí’ˆğŸšŒ
        </div>
        <div class="btn-group btn-group-sm" role="group" aria-label="Small button group" style="display: inline-block;">
          <button type="button" class="btn btn-outline-kong" value="defaultCondition">ìµœì‹ ìˆœ</button>
          <button type="button" class="btn btn-outline-kong" value="recommendStatus">ì¶”ì²œìˆœ</button>
          <button type="button" class="btn btn-outline-kong" value="rowPrice">ê°€ê²©ë‚®ì€ìˆœ</button>
          <button type="button" class="btn btn-outline-kong" value="highPrice">ê°€ê²©ë†’ì€ìˆœ</button>
        </div>
      </div>
      <hr>
      <div class="container">
        <div class="row" id="package_list"></div>
      </div>

      
    </div>
    <div class="col-1">      
    </div>
  </div>
  </div>

<script th:inline="javascript">
    // ì „ì—­ ë³€ìˆ˜
    var page = 1;
    var totalPage = 0;
    var param = 0;
    const url = new URL(window.location.href);
    
    var region = url.searchParams.get("regionNo");   
    if(url.searchParams.get("regionNo") == null){
      region = 0;
    } 
    $(document).ready(function() {
            const url = new URL(window.location.href);
            const regionNo = url.searchParams.get("regionNo");   
            // regionNoê°€ ìˆì„ ë•Œ ì •ë ¬ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            if (regionNo) {
                $('.btn-group').hide();
            }
          });

      $('.btn-outline-kong').click(function(){
        param = $(this).val();
        page = 1;
        totalPage = 0;
         $('#package_list').empty();
          fnGetPackageList(param);
      })

    const fnGetPackageList = (param, region) => {
        $.ajax({
            type: 'get',
            url: '/package/getList.do',
            data: {
                page: page,
                condition: param,
                regionNo: region || 0
            },
            dataType: 'json',
            success: (resData) => {
                totalPage = resData.totalPage;
                $('#count').empty();
                $('#count').append(resData.count);
                if (resData.packageList != null && resData.packageList.length > 0) {                   
                    $.each(resData.packageList, (i, package) => {
                        let str = '<div class="col-md-4">';
                        str += '<div class="card w-100 p-3">';
                        if (package.productImageDto && package.productImageDto.thumbnail === 1) {
                            str += '<img src="' + package.productImageDto.imagePath + '/' + package.productImageDto.filesystemName + '" style="height: 250px; " class="card-img-top" alt="Package Image">';
                        } else {
                            str += '<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fdc4Q17%2FbtsBykVk229%2FPtJu2VtYGEdKF5YDcZm7xK%2Fimg.jpg" style="height: 250px;" class="card-img-top" alt="Package Image">';
                        }
                        str += '<div class="card-body">';
                        str += '<p class="card-title">' + package.packageTitle + '</p>';
                        str += '<p class="card-text">'+ package.price +'ì›</p>';
                        str += '<p class="card-text"></p>';
                        str += '<a href="' + '/package/increseHit.do?packageNo=' + package.packageNo + '" class="btn btn-kong">ì—¬í–‰ê°€ê¸°</a>';
                        str += '</div>';
                        str += '</div>';
                        str += '</div>';
                        $('#package_list').append(str);
                    });
                } else {
                    console.log('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
            },
            error: (error) => {
                console.error('Ajax ìš”ì²­ ì—ëŸ¬:', error);
            }
        });
    }

    const fnScroll = () => {
        var timerId;
        $(window).on('scroll', () => {
            if (timerId) {
                clearTimeout(timerId);
            }
            timerId = setTimeout(() => {
                let scrollTop = $(window).scrollTop();
                let windowHeight = $(window).height();
                let documentHeight = $(document).height();
                if ((scrollTop + windowHeight + 100) >= documentHeight) {
                    if (page > totalPage) {
                        return;
                    }
                    page++;
                    fnGetPackageList(param);
                }
            }, 200);
        })
    }

    fnGetPackageList(param, region);
    fnScroll();
</script>



    <div th:replace="~{/layout/footer::footer}"></div>

 
</body>
</html>

