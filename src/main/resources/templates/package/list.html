<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

 <head th:replace="~{layout/header::head('íŒ¨í‚¤ì§€ìƒí’ˆë¦¬ìŠ¤íŠ¸')}"></head>
<style>
  .card {
      width: 18rem;
      margin-bottom: 20px;
  }

  .admin_btn {
      display: flex;
      justify-content: flex-end;
  }
  
  .btn-kong {
    background-color: #96B6C5;
    color:white;
      }
  .card-title {
    font-size: 20px;
    font-weight: 400;
  }
  .btn-outline-kong {
    color: rgb(23, 62, 104);
  } 
  .card-img-top {
        height: 200px; /* ì›í•˜ëŠ” ì¹´ë“œ ì´ë¯¸ì§€ ë†’ì´ */
        object-fit: cover; /* ì´ë¯¸ì§€ê°€ ì¹´ë“œì— ë§ê²Œ ì¡°ì ˆë  ìˆ˜ ìˆë„ë¡ ì„¤ì • */
        width: 100%; /* ê°€ë¡œ í¬ê¸°ë¥¼ 100%ë¡œ ì„¤ì •í•˜ì—¬ ì¹´ë“œ ì•ˆì— ê½‰ ì°¨ê²Œ í•¨ */
    }
  hr {
    border-top: 1px solid black; /* ë‘ê»˜ ì¡°ì ˆ ê°€ëŠ¥ */
    margin: 20px 0; /* í•„ìš”ì— ë”°ë¼ ë§ˆì§„ ì¡°ì ˆ ê°€ëŠ¥ */
  }


/* í˜¸ë²„ ìƒíƒœ */
.btn-outline-kong:hover {
    color: #FF8F8F;
}
</style>  
<body>

  <div th:replace="~{layout/header::header}"></div>

  <div class="container text-center">  <!-- ê·¸ë¦¬ë“œ ì‹œì‘ -->  
  <div class="row">
    <div class="col-1">    
    </div>
    <div class="col-12" >
    <th:block th:if="${session.user != null}">
     <th:block th:if="${session.user.auth == 0}">
      <a th:href="@{/package/write.form}">
        <button type="button" class="admin_btn" style="margin-left: auto;">ê²Œì‹œê¸€ ì‘ì„±</button>
      </a> 
     </th:block>
   </th:block>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 25px;">
        <div style="display: inline-block;"> 
         <span id="count"></span>ê°œì˜ ìƒí’ˆğŸšŒ
        </div>
        <div class="btn-group btn-group-sm" role="group" aria-label="Small button group" style="display: inline-block;">
          <button type="button" class="btn btn-outline-kong" value="defaultCondition">ìµœì‹ ìˆœ</button>
          <button type="button" class="btn btn-outline-kong" value="recommendStatus">ì¶”ì²œìˆœ</button>
          <button type="button" class="btn btn-outline-kong" value="rowPrice">ê°€ê²©ë‚®ì€ìˆœ</button>
          <button type="button" class="btn btn-outline-kong" value="highPrice">ê°€ê²©ë†’ì€ìˆœ</button>
        </div>
      </div>
      <hr>
      <div class="container">
        <div class="row" id="package_list"></div>
      </div>

      
    </div>
    <div class="col-1">      
    </div>
  </div>
  </div>

<script th:inline="javascript">
    // ì „ì—­ ë³€ìˆ˜
    var page = 1;
    var totalPage = 0;
    var param = 0;
    const url = new URL(window.location.href);
    
    var region = url.searchParams.get("regionNo");   
    if(url.searchParams.get("regionNo") == null){
      region = 0;
    } 
    $(document).ready(function() {
            const url = new URL(window.location.href);
            const regionNo = url.searchParams.get("regionNo");   
            // regionNoê°€ ìˆì„ ë•Œ ì •ë ¬ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            if (regionNo) {
                $('.btn-group').hide();
            }
          });

      $('.btn-outline-kong').click(function(){
        param = $(this).val();
        page = 1;
        totalPage = 0;
         $('#package_list').empty();
          fnGetPackageList(param);
      })

  const fnGetPackageList = (param, region) => {
    $.ajax({
        type: 'get',
        url: '/package/getList.do',
        data: {
            page: page,
            condition: param,
            regionNo: region || 0
        },
        dataType: 'json',
        success: (resData) => {
            totalPage = resData.totalPage;
            $('#count').empty();
            $('#count').append(resData.count);
            if (resData.packageList != null && resData.packageList.length > 0) {
                 var address = '/package/increseHit.do?packageNo=';
                $.each(resData.packageList, (i, package) => {
                   let str = '<div class="col-md-3 mb-3">';
					str += `<div class="card w-100" style="height: 370px;" onclick="location.href='${address}${package.packageNo}'">`;
					
					// ì´ë¯¸ì§€ ë¶€ë¶„
					if (package.productImageDto && package.productImageDto.thumbnail === 1) {
					    str += `<img src="${package.productImageDto.imagePath}/${package.productImageDto.filesystemName}" class="card-img-top" style="height: 200px;" alt="Package Image">`;
					} else {
					    str += '<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fdc4Q17%2FbtsBykVk229%2FPtJu2VtYGEdKF5YDcZm7xK%2Fimg.jpg" class="card-img-top" alt="Package Image">';
					}
					
					str += '<div style="margin-top: 15px;">'; // ìˆ˜ì •ëœ ë¶€ë¶„: ê°„ê²© ì¡°ì ˆ
					str += '<div class="d-flex align-items-end" style="margin-left: 10px;">'; // ìˆ˜ì •ëœ ë¶€ë¶„: ìŠ¤íƒ€ì¼ ì ìš© ë¶€ë¶„ ë³€ê²½
					str += `<span class="badge rounded-pill text-bg-success">${package.miniOne}</span>`;
					str += `<span class="badge rounded-pill text-bg-warning">${package.miniTwo}</span>`;
					str += `<span class="badge rounded-pill text-bg-info">${package.miniThree}</span>`;
					str += '</div>';
					str += '</div>';
					
					// ë‚´ìš© ë¶€ë¶„
					str += `<div class="card-body d-flex flex-column justify-content-between" style="height: 200px;">`; // ìˆ˜ì •ëœ ë¶€ë¶„: heightë¥¼ ì¤„ì„
					str += `<p class="card-title">${package.packageTitle}</p>`;
					str += '<div style="margin-bottom: 20px; margin-right:15px; text-align: right;">';
					str += `<p class="card-text mb-0" >~${package.price}ì›</p>`; // ìˆ˜ì •ëœ ë¶€ë¶„: í…ìŠ¤íŠ¸ë¥¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™
					str += '</div>';
					str += '</div>';
					str += '</div>';
					str += '</div>';

                    $('#package_list').append(str);
                });
            } else {
                console.log('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        },
        error: (error) => {
            console.error('Ajax ìš”ì²­ ì—ëŸ¬:', error);
        }
    });
}



    const fnScroll = () => {
        var timerId;
        $(window).on('scroll', () => {
            if (timerId) {
                clearTimeout(timerId);
            }
            timerId = setTimeout(() => {
                let scrollTop = $(window).scrollTop();
                let windowHeight = $(window).height();
                let documentHeight = $(document).height();
                if ((scrollTop + windowHeight + 100) >= documentHeight) {
                    if (page > totalPage) {
                        return;
                    }
                    page++;
                    fnGetPackageList(param);
                }
            }, 200);
        })
    }

    fnGetPackageList(param, region);
    fnScroll();
</script>



    <div th:replace="~{layout/footer::footer}"></div>

 
</body>
</html>

