<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{/layout/header::head('패키지썸네일')}"></head>
<style>

#previewId {
   width: 560px;
   height: 270px;
   margin-top: 20px;
   margin-bottom: 30px;    
    }
</style>
<body>
	
	<div th:replace="~{/layout/header::header}"></div>
	
	<div class="container text-center">  <!-- 그리드 시작 -->  
	  <div class="row">
	    <div class="col-1">
	    </div>
	    <div class="col-10" >
		<h2>썸네일</h2>
	<form method="post" id="frm_product_add" th:action="@{/package/addThumbnail.do}" enctype="multipart/form-data">
	  <div style="margin: 30px 270px;" class="w-50 p-3">		 
		  
    <div>
          <div id="previewId"></div>
          <textarea rows="10" cols="30" name="packageTitle"></textarea>
    	  <div>
    	  	<label for="thumbnailFiles" class="form-label">썸네일첨부</label>
    	  	 <input type="hidden" th:value="${map.packageNo}" name="packageNo">
		    <input type="file" name="thumbnailFiles" id="thumbnailFiles" class="input-group-text"  onchange="previewImage(this,'previewId')" accept="image/gif,image/jpeg,image/png" required/>
    	  </div>    	  

		  <div class="d-grid gap-2 col-6 mx-auto">	
			  <input type="hidden" th:value="${map.packageNo}" name="packageNo">
			  <input type="hidden" name="thumbnail" th:value="1">	     
		      <button type="submit" class="btn btn-primary" style="margin: 32px;">첨부완료</button>
	      </div>
		 </div>
		 </div>
		</form>
		
		</div>
    <div class="col-1">      
    </div>
  </div>
  </div>
<script th:inline="javascript">
	
	function previewImage(targetObj, previewId) {
		
		 var preview = document.getElementById(previewId); //div id   
	     var ua = window.navigator.userAgent;
	
	     var thumbnailFiles = targetObj.thumbnailFiles;
	     for ( var i = 0; i < thumbnailFiles.length; i++) {
	
	         var file = thumbnailFiles[i];
	
	         var imageType = /image.*/; //이미지 파일일경우만.. 뿌려준다.
	         if (!file.type.match(imageType))
	             continue;
	
	         var prevImg = document.getElementById("prev_" + previewId); //이전에 미리보기가 있다면 삭제
	         if (prevImg) {
	             preview.removeChild(prevImg);
	         }
	         var img = document.createElement("img"); //크롬은 div에 이미지가 뿌려지지 않는다. 그래서 자식Element를 만든다.
	         img.id = "prev_" + previewId;
	         img.classList.add("obj");
	         img.file = file;
	         img.style.width = '560px'; //기본설정된 div의 안에 뿌려지는 효과를 주기 위해서 div크기와 같은 크기를 지정해준다.
	         img.style.height = '270px';
	         
	         preview.appendChild(img);
	
	         if (window.FileReader) { // FireFox, Chrome, Opera 확인.
	             var reader = new FileReader();
	             reader.onloadend = (function(aImg) {
	                 return function(e) {
	                     aImg.src = e.target.result;
	                 };
	             })(img);
	             reader.readAsDataURL(file);
	         }   
	     }       
	  }
	
	const fnFileCheck = () => {
		    $('#image').change((ev) => {
		      let maxSize = 1024 * 1024 * 100;
		      let maxSizePerFile = 1024 * 1024 * 10;
		      let totalSize = 0;
		      let thumbnailFiles = ev.target.thumbnailFiles;
		      for(let i = 0; i < thumbnailFiles.length; i++){
		        totalSize += thumbnailFiles[i].size;
		        if(thumbnailFiles[i].size > maxSizePerFile){
		          alert('각 첨부파일의 최대 크기는 10MB입니다.');
		          $(ev.target).val('');
		          return;
		        }
		      }
		      if(totalSize > maxSize){
		        alert('전체 첨부파일의 최대 크기는 100MB입니다.');
		        $(ev.target).val('');
		        return;
		      }
		    })
		  }
		  
		  
	fnFileCheck();	  
</script>



<div th:replace="~{/layout/footer::footer}"></div>
</body>
</html>

