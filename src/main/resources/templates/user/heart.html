<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{/layout/header::head('Ï∞úÌéòÏù¥ÏßÄ')}"></head>


<body>
  
  <div th:replace="~{/layout/header::header}"></div>
  
  <div class="container text-center">  <!-- Í∑∏Î¶¨Îìú ÏãúÏûë -->  
    <div class="row">
      <div class="col-1">
    <div class="w3-sidebar w3-bar-block" style="width:8%; height:200px;"> <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
      <a href='' class="w3-bar-item w3-button">ÎÇ¥ Ï†ïÎ≥¥</a>
      <a href='' class="w3-bar-item w3-button">ÎÇ¥ ÏòàÏïΩ</a>
    </div>    
      </div>
      <div class="col-10">
       <table class="table w-75 p-3" style="margin: auto;">
          <thead>
            <tr class="table-success">
              <th scope="col">‚ù§Ô∏è
                 <input type="checkbox" class="form-check-input" id="chk_all">
                 <label class="form-check-label" for="chk_all">
                </label>
              </th>
              <th scope="col">ÏÉÅÌíàÎ™Ö</th>
              <th scope="col">Í∞ÄÍ≤©</th>
            </tr>
          </thead>
          <tbody>
           <input type="hidden" id="userNo" th:value="${session.user.userNo}">
           <th:block th:if="${#lists.isEmpty(heartList)}">
             <tr style="text-align: center;"> 
                <td></td>
                <td>Ï∞úÌïú ÏÉÅÌíàÏù¥ ÏóÜÏäµÎãàÎã§.</td>
                <td></td>
             </tr>
            </th:block>
           <th:block  th:each=" heart :${heartList}">
            <tr>             
              <td scope="row">üíô
                  <input type="checkbox" class="form-check-input chk_each" th:value="${heart.packageDto.packageNo}">
                  <label class="form-check-label">
                  </label>
              </td>
              <td>
                <input type="hidden" id="packageNo" th:value="${heart.packageDto.packageNo}">
                <a th:href="@{/package/detail.do(packageNo=${heart.packageDto.packageNo})}" th:text="${heart.packageDto.packageTitle}"></a>
              </td>
              <td th:text="|${heart.packageDto.price} Ïõê|"></td>
            </tr>
           </th:block>
          </tbody>
          <tfoot>
           <th:block th:unless="${#lists.isEmpty(heartList)}">
                <tr>
                    <td>
                        <button type="button" class="btn btn-danger remove_heart" onclick="deleteSelected()">ÏÇ≠Ï†ú</button>
                    </td>
                    <td th:utext="${paging}" class="paging"></td>
                    <td></td>
                </tr>
            </th:block>
          </tfoot>
          </table>           
      </div>
    <div class="col-1">      
    </div>
  </div>
  </div>
  
  <script th:inline="javascript">

 // Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú ÏÑ†Ïñ∏
      var total = 0;
      var selectedItems = [];
      
      const fnChkAll = () => {
        $('#chk_all').click((ev) => {
          $('.chk_each').prop('checked', $(ev.target).prop('checked'));
          updateSelectedItems();
        });
      }
      
      const fnChkEach = () => {
        $(document).on('click', '.chk_each', () => {
          updateSelectedItems();
        });
      
        // ÏÑ†ÌÉùÎêú Ìï≠Î™© ÏÇ≠Ï†ú
        $('.remove_heart').click(() => {
          deleteSelected(selectedItems);
        });
      }
      
      const updateSelectedItems = () => {
        total = 0;
        selectedItems = [];
        $.each($('.chk_each'), (i, elem) => {
          total += $(elem).prop('checked') ? 1 : 0;
          if ($(elem).prop('checked')) {
            selectedItems.push($(elem).val());
          }
        });
        $('#chk_all').prop('checked', total === $('.chk_each').length);
      };
      
      const deleteSelected = (selectedItems) => {
        if (selectedItems.length === 0) {
          alert('ÏÇ≠Ï†úÌï† Ìï≠Î™©ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.');
          return;
        }
  
    var confirmResult = confirm('ÏÑ†ÌÉùÎêú Ìï≠Î™©ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?');
    if (confirmResult) {
      $.each(selectedItems, (index, packageNo) => {
        var userNo = $('#userNo').val();
  
        $.ajax({
          type: 'post',
          url: '/user/removeHeart.do',
          data: { userNo: userNo, packageNo: packageNo },
          dataType: 'json',
          success: (resData) => {
            if (resData.removeHeartResult === 1) {
              $('.chk_each[value=' + packageNo + ']').closest('tr').remove();
              console.log('ÏÑ±Í≥µ');
            } else {
              console.error('ÏÇ≠Ï†ú Ïã§Ìå®');
            }
          },
          error: (error) => {
            console.error('ÏÇ≠Ï†ú ÏöîÏ≤≠ ÏóêÎü¨:', error);
            alert('ÏÇ≠Ï†ú Ï§ë ÏóêÎü¨Í∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
          }
        });
      });
    }
  };

    // ÌéòÏù¥ÏßÄ Î°úÎî© ÌõÑ Ï¥àÍ∏∞Ìôî
    $(() => {
      fnChkAll();
      fnChkEach();
    });

</script>
    
  <div th:replace="~{/layout/footer::footer}"></div>
  
</body>
</html>