<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{/layout/header::head('ë§ˆì´í˜ì´ì§€')}"></head>
<style>
  #split2 {
    flex: 0 0 80%;
  }
  .title {
    font-size: 30px;
  }
 
</style>

<script th:src="@{/js/user_modify.js(ver=1.0)}"></script>

<body>
  
  <div th:replace="~{/layout/header::header}"></div>
  
   <div class="main_wrap">
  
  
     <div class="container text-center">
      <div class="row">
        <div class="col-1"> 
      <!--/* ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ê³¼ ì°œ ëª©ë¡ìœ¼ë¡œ ì´ë™ ê°€ëŠ¥í•œ ì¢Œì¸¡ ë©”ë‰´ ë²„íŠ¼ */-->
         <div class="w3-sidebar w3-bar-block" style="width:20%; height:200px;"> <!-- ì‚¬ì´ë“œë°” -->
          <a th:href="@{/user/modifyPw.form}" class="w3-bar-item w3-button">ë¹„ë°€ë²ˆí˜¸ë³€ê²½í•˜ê¸°ğŸ’¡</a>
          <a th:href="@{/reserve/reserveList.do(userNo=${session.user.userNo})}" class="w3-bar-item w3-button">ë‚˜ì˜ ì˜ˆì•½ë³´ê¸°ğŸ“†</a>
          <a th:href="@{/user/heart.do(userNo=${session.user.userNo})}" class="w3-bar-item w3-button">ë‚˜ì˜ ì°œí•œëª©ë¡ë³´ê¸°ğŸ’š</a>
         </div>         
        </div>
        <div class="col-10" >
    
    <div id="main_wraper">             
    <div id="split2" class="wrap wrap_6" th:if="${session.user != null}">
    
      <p class="title">ğŸ§’ë§ˆì´í˜ì´ì§€ğŸ‘©</p>
    
      <form id="frm_mypage" method="post">
        
        <div th:if="${session.user.state == 0}" class="text-center">
          <div class="mb-2">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
          <button type="button" id="btn_modify_pw" class="btn btn-danger">ë¹„ë°€ë²ˆí˜¸ë³€ê²½í•˜ê¸°</button>
        </div>
        <hr class="my-3">
        
        <div class="text-center mb-4">ê°œì¸ì •ë³´ ë³€ê²½</div>
        <div class="row mb-4">
          <div class="col-sm-3">ì´ë©”ì¼</div>
          <div class="col-sm-9" th:text="${session.user.email}"></div>
        </div>
        <div class="row mb-4">
          <div class="col-sm-3">ê°€ì…ì¼</div>
          <div class="col-sm-9" th:text="${#dates.format(session.user.joinedAt, 'yyyy-MM-dd a hh:mm:ss')}"></div>
        </div>
        <div class="row mb-2">
          <label for="name" class="col-sm-3 col-form-label">ì´ë¦„</label>
          <div class="col-sm-9"><input type="text" name="name" th:value="${session.user.name}" id="name" class="form-control w-50 p-3 h-50 d-inline-block"></div>
          <div class="col-sm-3"></div>
          <div class="col-sm-9 mb-3" id="msg_name"></div>
        </div>
        <div class="row mb-2">
          <label for="mobile" class="col-sm-3 col-form-label">í•¸ë“œí°</label>
          <div class="col-sm-9"><input type="text" name="mobile" th:value="${session.user.mobile}" id="mobile" class="form-control w-50 p-3 h-50 d-inline-block"></div>
          <div class="col-sm-3"></div>
          <div class="col-sm-9 mb-3" id="msg_mobile"></div>
        </div>       
        <div class="row mb-2">
          <label class="col-sm-3 form-label">ì„±ë³„</label>
          <div class="col-sm-3">
            <input type="radio" name="gender" value="NO" id="none" class="form-check-input" checked>
            <label class="form-check-label" for="none">ì„ íƒì•ˆí•¨</label>
          </div>
          <div class="col-sm-3">
            <input type="radio" name="gender" value="M" id="man" class="form-check-input">
            <label class="form-check-label" for="man">ë‚¨ì</label>
          </div>
          <div class="col-sm-3">
            <input type="radio" name="gender" value="F" id="woman" class="form-check-input">
            <label class="form-check-label" for="woman">ì—¬ì</label>
          </div>
        </div>
        <script th:inline="javascript">
          $(':radio[value=[[${session.user.gender}]]]').prop('checked', true);
        </script>
        
        <hr class="my-3">
        
        <div class="row mb-2">
          <label for="postcode" class="col-sm-3 col-form-label">ì£¼ì†Œ</label>
          <div class="col-sm-4"><input type="text" name="postcode" th:value="${session.user.postcode}" id="postcode" class="form-control" onclick="execDaumPostcode()" placeholder="ìš°í¸ë²ˆí˜¸" readonly></div>
          <div class="col-sm-5"><input type="button" class="btn btn-outline-success" onclick="execDaumPostcode()" value="ìš°í¸ë²ˆí˜¸ ì°¾ê¸°"></div>
        </div>
        
        <div>
          <label for="roadAddress" class="col-sm-3 col-form-label">ìƒì„¸ì£¼ì†Œ</label>
          <div class="col-sm-6"><input type="text" name="roadAddress" th:value="${session.user.roadAddress}" style="margin-bottom: 20px; margin-left: 45%;" id="roadAddress" class="form-control" placeholder="ë„ë¡œëª…ì£¼ì†Œ" readonly></div>
          <div class="col-sm-6"><input type="text" name="jibunAddress" th:value="${session.user.jibunAddress}" style="margin-bottom: 20px; margin-left: 45%;" id="jibunAddress" class="form-control" placeholder="ì§€ë²ˆì£¼ì†Œ" readonly></div>
        </div>
        <div class="col-sm-12"><span id="guide" style="color:#999;display:none"></span></div>
        <div class="row mb-2">
          <div class="col-sm-6"><input type="text" name="detailAddress" th:value="${session.user.detailAddress}" style="margin-left: 47%;" id="detailAddress" class="form-control" placeholder="ìƒì„¸ì£¼ì†Œ"></div>
          <div class="col-sm-6"><input type="hidden" id="extraAddress" class="form-control" placeholder="ì°¸ê³ í•­ëª©"></div>
        </div>
        <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
        <script>
          //ë³¸ ì˜ˆì œì—ì„œëŠ” ë„ë¡œëª… ì£¼ì†Œ í‘œê¸° ë°©ì‹ì— ëŒ€í•œ ë²•ë ¹ì— ë”°ë¼, ë‚´ë ¤ì˜¤ëŠ” ë°ì´í„°ë¥¼ ì¡°í•©í•˜ì—¬ ì˜¬ë°”ë¥¸ ì£¼ì†Œë¥¼ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.
          function execDaumPostcode() {
            new daum.Postcode({
              oncomplete: function(data) {
                // íŒì—…ì—ì„œ ê²€ìƒ‰ê²°ê³¼ í•­ëª©ì„ í´ë¦­í–ˆì„ë•Œ ì‹¤í–‰í•  ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë¶€ë¶„.
    
                // ë„ë¡œëª… ì£¼ì†Œì˜ ë…¸ì¶œ ê·œì¹™ì— ë”°ë¼ ì£¼ì†Œë¥¼ í‘œì‹œí•œë‹¤.
                // ë‚´ë ¤ì˜¤ëŠ” ë³€ìˆ˜ê°€ ê°’ì´ ì—†ëŠ” ê²½ìš°ì—” ê³µë°±('')ê°’ì„ ê°€ì§€ë¯€ë¡œ, ì´ë¥¼ ì°¸ê³ í•˜ì—¬ ë¶„ê¸° í•œë‹¤.
                var roadAddr = data.roadAddress; // ë„ë¡œëª… ì£¼ì†Œ ë³€ìˆ˜
                var extraRoadAddr = ''; // ì°¸ê³  í•­ëª© ë³€ìˆ˜
    
                // ë²•ì •ë™ëª…ì´ ìˆì„ ê²½ìš° ì¶”ê°€í•œë‹¤. (ë²•ì •ë¦¬ëŠ” ì œì™¸)
                // ë²•ì •ë™ì˜ ê²½ìš° ë§ˆì§€ë§‰ ë¬¸ìê°€ "ë™/ë¡œ/ê°€"ë¡œ ëë‚œë‹¤.
                if(data.bname !== '' && /[ë™|ë¡œ|ê°€]$/g.test(data.bname)){
                  extraRoadAddr += data.bname;
                }
                // ê±´ë¬¼ëª…ì´ ìˆê³ , ê³µë™ì£¼íƒì¼ ê²½ìš° ì¶”ê°€í•œë‹¤.
                if(data.buildingName !== '' && data.apartment === 'Y'){
                  extraRoadAddr += (extraRoadAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                }
                // í‘œì‹œí•  ì°¸ê³ í•­ëª©ì´ ìˆì„ ê²½ìš°, ê´„í˜¸ê¹Œì§€ ì¶”ê°€í•œ ìµœì¢… ë¬¸ìì—´ì„ ë§Œë“ ë‹¤.
                if(extraRoadAddr !== ''){
                  extraRoadAddr = ' (' + extraRoadAddr + ')';
                }
    
                // ìš°í¸ë²ˆí˜¸ì™€ ì£¼ì†Œ ì •ë³´ë¥¼ í•´ë‹¹ í•„ë“œì— ë„£ëŠ”ë‹¤.
                document.getElementById('postcode').value = data.zonecode;
                document.getElementById("roadAddress").value = roadAddr;
                document.getElementById("jibunAddress").value = data.jibunAddress;
                
                // ì°¸ê³ í•­ëª© ë¬¸ìì—´ì´ ìˆì„ ê²½ìš° í•´ë‹¹ í•„ë“œì— ë„£ëŠ”ë‹¤.
                if(roadAddr !== ''){
                  document.getElementById("extraAddress").value = extraRoadAddr;
                } else {
                  document.getElementById("extraAddress").value = '';
                }
    
                var guideTextBox = document.getElementById("guide");
                // ì‚¬ìš©ìê°€ 'ì„ íƒ ì•ˆí•¨'ì„ í´ë¦­í•œ ê²½ìš°, ì˜ˆìƒ ì£¼ì†Œë¼ëŠ” í‘œì‹œë¥¼ í•´ì¤€ë‹¤.
                if(data.autoRoadAddress) {
                  var expRoadAddr = data.autoRoadAddress + extraRoadAddr;
                  guideTextBox.innerHTML = '(ì˜ˆìƒ ë„ë¡œëª… ì£¼ì†Œ : ' + expRoadAddr + ')';
                  guideTextBox.style.display = 'block';
                } else if(data.autoJibunAddress) {
                  var expJibunAddr = data.autoJibunAddress;
                  guideTextBox.innerHTML = '(ì˜ˆìƒ ì§€ë²ˆ ì£¼ì†Œ : ' + expJibunAddr + ')';
                  guideTextBox.style.display = 'block';
                } else {
                  guideTextBox.innerHTML = '';
                  guideTextBox.style.display = 'none';
                }
              }
            }).open();
          }
        </script>
        
        <div class="row mt-3">
          <label class="col-sm-12 form-label">ì´ë²¤íŠ¸ ì•Œë¦¼ ë™ì˜(ì„ íƒ)</label>
        </div>
        <div class="row mb-2">
          <div class="col-sm-3">
            <input type="radio" name="event" value="on" id="event_on" class="form-check-input">
            <label class="form-check-label" for="event_on">ë™ì˜í•¨</label>
          </div>
          <div class="col-sm-3">
            <input type="radio" name="event" value="off" id="event_off" class="form-check-input">
            <label class="form-check-label" for="event_off">ë™ì˜ì•ˆí•¨</label>
          </div>
        </div>
        <script th:inline="javascript">
          let agree = /*[[${session.user.agree}]]*/ null;
          if(agree === 0){
            $('#event_off').prop('checked', true);
          } else if(agree === 1){
            $('#event_on').prop('checked', true);
          }
        </script>
        
        <hr class="my-3">
        
        <div class="text-center">
          <input type="hidden" name="userNo" th:value="${session.user.userNo}">
          <button type="button" id="btn_leave" class="btn btn-dark">íšŒì›íƒˆí‡´</button>
          <button type="button" id="btn_modify" class="btn btn-success">ê°œì¸ì •ë³´ìˆ˜ì •</button>
        </div>
        
          
        
        
      </form>
    
    </div>
    
    <div th:if="${session.user == null}">
      ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.
    </div>

  </div>
  
  <div th:replace="~{/layout/footer::footer}"></div>
  
</body>
</html>